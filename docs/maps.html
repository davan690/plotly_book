<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Maps | Interactive web-based data visualization with R, plotly, and shiny</title>
  <meta name="description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  <meta name="generator" content="bookdown 0.16.5 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Maps | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Maps | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  

<meta name="author" content="Carson Sievert" />


<meta name="date" content="2019-12-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scatter-traces.html"/>
<link rel="next" href="bars-histograms.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<script src="libs/elevate-section-attrs/elevate-section-attrs.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize/selectize.min.js"></script>
<link href="libs/colourpicker/colourpicker.min.css" rel="stylesheet" />
<script src="libs/colourpicker/colourpicker.min.js"></script>
<link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding/datatables.js"></script>
<link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/summary-fix.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="preface.html"><a href="preface.html#why-interactive-web-graphics-from-r"><i class="fa fa-check"></i><b>1.1</b> Why interactive web graphics <em>from R</em>?</a></li>
<li class="chapter" data-level="1.2" data-path="preface.html"><a href="preface.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.2</b> What you will learn</a></li>
<li class="chapter" data-level="1.3" data-path="preface.html"><a href="preface.html#what-you-wont-learn-much-of"><i class="fa fa-check"></i><b>1.3</b> What you won’t learn (much of)</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="preface.html"><a href="preface.html#web-technologies"><i class="fa fa-check"></i><b>1.3.1</b> Web technologies</a></li>
<li class="chapter" data-level="1.3.2" data-path="preface.html"><a href="preface.html#d3js"><i class="fa fa-check"></i><b>1.3.2</b> d3js</a></li>
<li class="chapter" data-level="1.3.3" data-path="preface.html"><a href="preface.html#ggplot2"><i class="fa fa-check"></i><b>1.3.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.3.4" data-path="preface.html"><a href="preface.html#graphical-data-analysis"><i class="fa fa-check"></i><b>1.3.4</b> Graphical data analysis</a></li>
<li class="chapter" data-level="1.3.5" data-path="preface.html"><a href="preface.html#data-visualization-best-practices"><i class="fa fa-check"></i><b>1.3.5</b> Data visualization best practices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="preface.html"><a href="preface.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="preface.html"><a href="preface.html#run-code-examples"><i class="fa fa-check"></i><b>1.5</b> Run code examples</a></li>
<li class="chapter" data-level="1.6" data-path="preface.html"><a href="preface.html#getting-help-and-learning-more"><i class="fa fa-check"></i><b>1.6</b> Getting help and learning more</a></li>
<li class="chapter" data-level="1.7" data-path="preface.html"><a href="preface.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.8" data-path="preface.html"><a href="preface.html#colophon"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Creating views</b></span></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#intro-plotly"><i class="fa fa-check"></i><b>2.1</b> Intro to <code>plot_ly()</code></a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#intro-plotly-js"><i class="fa fa-check"></i><b>2.2</b> Intro to plotly.js</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#intro-ggplotly"><i class="fa fa-check"></i><b>2.3</b> Intro to <code>ggplotly()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>3</b> Scattered foundations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#markers"><i class="fa fa-check"></i><b>3.1</b> Markers</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-alpha"><i class="fa fa-check"></i><b>3.1.1</b> Alpha blending</a></li>
<li class="chapter" data-level="3.1.2" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-color"><i class="fa fa-check"></i><b>3.1.2</b> Colors</a></li>
<li class="chapter" data-level="3.1.3" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-symbol"><i class="fa fa-check"></i><b>3.1.3</b> Symbols</a></li>
<li class="chapter" data-level="3.1.4" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-stroke"><i class="fa fa-check"></i><b>3.1.4</b> Stroke and span</a></li>
<li class="chapter" data-level="3.1.5" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-size"><i class="fa fa-check"></i><b>3.1.5</b> Size</a></li>
<li class="chapter" data-level="3.1.6" data-path="scatter-traces.html"><a href="scatter-traces.html#dot-plots"><i class="fa fa-check"></i><b>3.1.6</b> Dotplots &amp; error bars</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="scatter-traces.html"><a href="scatter-traces.html#lines"><i class="fa fa-check"></i><b>3.2</b> Lines</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="scatter-traces.html"><a href="scatter-traces.html#linetypes"><i class="fa fa-check"></i><b>3.2.1</b> Linetypes</a></li>
<li class="chapter" data-level="3.2.2" data-path="scatter-traces.html"><a href="scatter-traces.html#segments"><i class="fa fa-check"></i><b>3.2.2</b> Segments</a></li>
<li class="chapter" data-level="3.2.3" data-path="scatter-traces.html"><a href="scatter-traces.html#density-plots"><i class="fa fa-check"></i><b>3.2.3</b> Density plots</a></li>
<li class="chapter" data-level="3.2.4" data-path="scatter-traces.html"><a href="scatter-traces.html#parallel-coordinates"><i class="fa fa-check"></i><b>3.2.4</b> Parallel Coordinates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scatter-traces.html"><a href="scatter-traces.html#polygons"><i class="fa fa-check"></i><b>3.3</b> Polygons</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#ribbons"><i class="fa fa-check"></i><b>3.3.1</b> Ribbons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>4</b> Maps</a>
<ul>
<li class="chapter" data-level="4.1" data-path="maps.html"><a href="maps.html#maps-integrated"><i class="fa fa-check"></i><b>4.1</b> Integrated maps</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="maps.html"><a href="maps.html#overview-1"><i class="fa fa-check"></i><b>4.1.1</b> Overview</a></li>
<li class="chapter" data-level="4.1.2" data-path="maps.html"><a href="maps.html#choropleths"><i class="fa fa-check"></i><b>4.1.2</b> Choropleths</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="maps.html"><a href="maps.html#maps-custom"><i class="fa fa-check"></i><b>4.2</b> Custom maps</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="maps.html"><a href="maps.html#sf"><i class="fa fa-check"></i><b>4.2.1</b> Simple features (sf)</a></li>
<li class="chapter" data-level="4.2.2" data-path="maps.html"><a href="maps.html#cartograms"><i class="fa fa-check"></i><b>4.2.2</b> Cartograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>5</b> Bars &amp; histograms</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-numeric-distributions"><i class="fa fa-check"></i><b>5.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="5.2" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-discrete-distributions"><i class="fa fa-check"></i><b>5.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>6</b> Boxplots</a></li>
<li class="chapter" data-level="7" data-path="frequencies-2D.html"><a href="frequencies-2D.html"><i class="fa fa-check"></i><b>7</b> 2D frequencies</a>
<ul>
<li class="chapter" data-level="7.1" data-path="frequencies-2D.html"><a href="frequencies-2D.html#rectangular-binning-in-plotly.js"><i class="fa fa-check"></i><b>7.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="7.2" data-path="frequencies-2D.html"><a href="frequencies-2D.html#rectangular-binning-in-r"><i class="fa fa-check"></i><b>7.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="7.3" data-path="frequencies-2D.html"><a href="frequencies-2D.html#categorical-axes"><i class="fa fa-check"></i><b>7.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="d-charts.html"><a href="d-charts.html"><i class="fa fa-check"></i><b>8</b> 3D charts</a>
<ul>
<li class="chapter" data-level="8.1" data-path="d-charts.html"><a href="d-charts.html#markers-1"><i class="fa fa-check"></i><b>8.1</b> Markers</a></li>
<li class="chapter" data-level="8.2" data-path="d-charts.html"><a href="d-charts.html#paths"><i class="fa fa-check"></i><b>8.2</b> Paths</a></li>
<li class="chapter" data-level="8.3" data-path="d-charts.html"><a href="d-charts.html#lines-1"><i class="fa fa-check"></i><b>8.3</b> Lines</a></li>
<li class="chapter" data-level="8.4" data-path="d-charts.html"><a href="d-charts.html#axes"><i class="fa fa-check"></i><b>8.4</b> Axes</a></li>
<li class="chapter" data-level="8.5" data-path="d-charts.html"><a href="d-charts.html#surfaces"><i class="fa fa-check"></i><b>8.5</b> Surfaces</a></li>
</ul></li>
<li class="part"><span><b>II Publishing views</b></span></li>
<li class="chapter" data-level="9" data-path="publish.html"><a href="publish.html"><i class="fa fa-check"></i><b>9</b> Introduction</a></li>
<li class="chapter" data-level="10" data-path="saving.html"><a href="saving.html"><i class="fa fa-check"></i><b>10</b> Saving and embedding HTML</a></li>
<li class="chapter" data-level="11" data-path="exporting-static-images.html"><a href="exporting-static-images.html"><i class="fa fa-check"></i><b>11</b> Exporting static images</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exporting-static-images.html"><a href="exporting-static-images.html#with-code"><i class="fa fa-check"></i><b>11.1</b> With code</a></li>
<li class="chapter" data-level="11.2" data-path="exporting-static-images.html"><a href="exporting-static-images.html#from-a-browser"><i class="fa fa-check"></i><b>11.2</b> From a browser</a></li>
<li class="chapter" data-level="11.3" data-path="exporting-static-images.html"><a href="exporting-static-images.html#sizing-exports"><i class="fa fa-check"></i><b>11.3</b> Sizing exports</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="editing-views.html"><a href="editing-views.html"><i class="fa fa-check"></i><b>12</b> Editing views for publishing</a></li>
<li class="part"><span><b>III Combining multiple views</b></span></li>
<li class="chapter" data-level="13" data-path="arranging-views.html"><a href="arranging-views.html"><i class="fa fa-check"></i><b>13</b> Arranging views</a>
<ul>
<li class="chapter" data-level="13.1" data-path="arranging-views.html"><a href="arranging-views.html#arranging-plotly-objects"><i class="fa fa-check"></i><b>13.1</b> Arranging plotly objects</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="arranging-views.html"><a href="arranging-views.html#recursive-subplots"><i class="fa fa-check"></i><b>13.1.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="13.1.2" data-path="arranging-views.html"><a href="arranging-views.html#other-approaches-applications"><i class="fa fa-check"></i><b>13.1.2</b> Other approaches &amp; applications</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="arranging-views.html"><a href="arranging-views.html#arranging-htmlwidgets"><i class="fa fa-check"></i><b>13.2</b> Arranging htmlwidgets</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="arranging-views.html"><a href="arranging-views.html#flexdashboard"><i class="fa fa-check"></i><b>13.2.1</b> Flexdashboard</a></li>
<li class="chapter" data-level="13.2.2" data-path="arranging-views.html"><a href="arranging-views.html#bootstrap-grid-layout"><i class="fa fa-check"></i><b>13.2.2</b> Bootstrap grid layout</a></li>
<li class="chapter" data-level="13.2.3" data-path="arranging-views.html"><a href="arranging-views.html#css-flexbox"><i class="fa fa-check"></i><b>13.2.3</b> CSS flexbox</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="arranging-views.html"><a href="arranging-views.html#navigating-many-views"><i class="fa fa-check"></i><b>13.3</b> Arranging many views</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>14</b> Animating views</a>
<ul>
<li class="chapter" data-level="14.1" data-path="animating-views.html"><a href="animating-views.html#animation-api"><i class="fa fa-check"></i><b>14.1</b> Animation API</a></li>
<li class="chapter" data-level="14.2" data-path="animating-views.html"><a href="animating-views.html#animation-support"><i class="fa fa-check"></i><b>14.2</b> Animation support</a></li>
</ul></li>
<li class="part"><span><b>IV Linking multiple views</b></span></li>
<li class="chapter" data-level="15" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>15</b> Introduction</a></li>
<li class="chapter" data-level="16" data-path="client-side-linking.html"><a href="client-side-linking.html"><i class="fa fa-check"></i><b>16</b> Client-side linking</a>
<ul>
<li class="chapter" data-level="16.1" data-path="client-side-linking.html"><a href="client-side-linking.html#graphical-queries"><i class="fa fa-check"></i><b>16.1</b> Graphical queries</a></li>
<li class="chapter" data-level="16.2" data-path="client-side-linking.html"><a href="client-side-linking.html#filter"><i class="fa fa-check"></i><b>16.2</b> Highlight versus filter events</a></li>
<li class="chapter" data-level="16.3" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-animated-views"><i class="fa fa-check"></i><b>16.3</b> Linking animated views</a></li>
<li class="chapter" data-level="16.4" data-path="client-side-linking.html"><a href="client-side-linking.html#querying-examples"><i class="fa fa-check"></i><b>16.4</b> Examples</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="client-side-linking.html"><a href="client-side-linking.html#trellis-linking"><i class="fa fa-check"></i><b>16.4.1</b> Querying facetted charts</a></li>
<li class="chapter" data-level="16.4.2" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries"><i class="fa fa-check"></i><b>16.4.2</b> Statistical queries</a></li>
<li class="chapter" data-level="16.4.3" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries-ggplot"><i class="fa fa-check"></i><b>16.4.3</b> Statistical queries with <code>ggplotly()</code></a></li>
<li class="chapter" data-level="16.4.4" data-path="client-side-linking.html"><a href="client-side-linking.html#geo-spatial-queries"><i class="fa fa-check"></i><b>16.4.4</b> Geo-spatial queries</a></li>
<li class="chapter" data-level="16.4.5" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>16.4.5</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="16.4.6" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggpairs"><i class="fa fa-check"></i><b>16.4.6</b> Generalized pairs plots</a></li>
<li class="chapter" data-level="16.4.7" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggnostic"><i class="fa fa-check"></i><b>16.4.7</b> Querying diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="client-side-linking.html"><a href="client-side-linking.html#limitations"><i class="fa fa-check"></i><b>16.5</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html"><i class="fa fa-check"></i><b>17</b> Server-side linking with shiny</a>
<ul>
<li class="chapter" data-level="17.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#hello-shiny"><i class="fa fa-check"></i><b>17.1</b> Embedding plotly in shiny</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>17.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="17.1.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#hiding-and-redrawing-on-resize"><i class="fa fa-check"></i><b>17.1.2</b> Hiding and redrawing on resize</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#shiny-plotly-inputs"><i class="fa fa-check"></i><b>17.2</b> Leveraging plotly input events</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#dragging-events"><i class="fa fa-check"></i><b>17.2.1</b> Dragging events</a></li>
<li class="chapter" data-level="17.2.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#d-events"><i class="fa fa-check"></i><b>17.2.2</b> 3D events</a></li>
<li class="chapter" data-level="17.2.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#edit-events"><i class="fa fa-check"></i><b>17.2.3</b> Edit events</a></li>
<li class="chapter" data-level="17.2.4" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#relayout-vs-restyle-events"><i class="fa fa-check"></i><b>17.2.4</b> Relayout vs restyle events</a></li>
<li class="chapter" data-level="17.2.5" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#scoping-events"><i class="fa fa-check"></i><b>17.2.5</b> Scoping events</a></li>
<li class="chapter" data-level="17.2.6" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#event-priority"><i class="fa fa-check"></i><b>17.2.6</b> Event priority</a></li>
<li class="chapter" data-level="17.2.7" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#handling-discrete-axes"><i class="fa fa-check"></i><b>17.2.7</b> Handling discrete axes</a></li>
<li class="chapter" data-level="17.2.8" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#reactive-vals"><i class="fa fa-check"></i><b>17.2.8</b> Accumulating and managing event data</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#shiny-performance"><i class="fa fa-check"></i><b>17.3</b> Improving performance</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#proxies"><i class="fa fa-check"></i><b>17.3.1</b> Partial plotly updates</a></li>
<li class="chapter" data-level="17.3.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#partial-update-examples"><i class="fa fa-check"></i><b>17.3.2</b> Partial update examples</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#advanced-applications"><i class="fa fa-check"></i><b>17.4</b> Advanced applications</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#drill-down"><i class="fa fa-check"></i><b>17.4.1</b> Drill-down</a></li>
<li class="chapter" data-level="17.4.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#crossfilter"><i class="fa fa-check"></i><b>17.4.2</b> Cross-filter</a></li>
<li class="chapter" data-level="17.4.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#drag-brush"><i class="fa fa-check"></i><b>17.4.3</b> A draggable brush</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#discussion"><i class="fa fa-check"></i><b>17.5</b> Discussion</a></li>
</ul></li>
<li class="part"><span><b>V Event handling in JavaScript</b></span></li>
<li class="chapter" data-level="18" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>18</b> Introduction</a></li>
<li class="chapter" data-level="19" data-path="json.html"><a href="json.html"><i class="fa fa-check"></i><b>19</b> Working with JSON</a>
<ul>
<li class="chapter" data-level="19.1" data-path="json.html"><a href="json.html#assignment-subsetting-and-iteration"><i class="fa fa-check"></i><b>19.1</b> Assignment, subsetting, and iteration</a></li>
<li class="chapter" data-level="19.2" data-path="json.html"><a href="json.html#mapping-r-to-json"><i class="fa fa-check"></i><b>19.2</b> Mapping R to JSON</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="js-event-handlers.html"><a href="js-event-handlers.html"><i class="fa fa-check"></i><b>20</b> Adding custom event handlers</a></li>
<li class="chapter" data-level="21" data-path="supplying-custom-data.html"><a href="supplying-custom-data.html"><i class="fa fa-check"></i><b>21</b> Supplying custom data</a></li>
<li class="chapter" data-level="22" data-path="client-side.html"><a href="client-side.html"><i class="fa fa-check"></i><b>22</b> Leveraging web technologies from R</a>
<ul>
<li class="chapter" data-level="22.1" data-path="client-side.html"><a href="client-side.html#web-infrastructure"><i class="fa fa-check"></i><b>22.1</b> Web infrastructure</a></li>
<li class="chapter" data-level="22.2" data-path="client-side.html"><a href="client-side.html#react"><i class="fa fa-check"></i><b>22.2</b> Modern JS &amp; React</a></li>
</ul></li>
<li class="part"><span><b>VI Various special topics</b></span></li>
<li class="chapter" data-level="23" data-path="is-plotly-free-secure.html"><a href="is-plotly-free-secure.html"><i class="fa fa-check"></i><b>23</b> Is plotly free &amp; secure?</a></li>
<li class="chapter" data-level="24" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a></li>
<li class="chapter" data-level="25" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html"><i class="fa fa-check"></i><b>25</b> Controlling tooltips</a>
<ul>
<li class="chapter" data-level="25.1" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text"><i class="fa fa-check"></i><b>25.1</b> <code>plot_ly()</code> tooltips</a></li>
<li class="chapter" data-level="25.2" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text-ggplotly"><i class="fa fa-check"></i><b>25.2</b> <code>ggplotly()</code> tooltips</a></li>
<li class="chapter" data-level="25.3" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#styling"><i class="fa fa-check"></i><b>25.3</b> Styling</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="control-modebar.html"><a href="control-modebar.html"><i class="fa fa-check"></i><b>26</b> Control the modebar</a>
<ul>
<li class="chapter" data-level="26.1" data-path="control-modebar.html"><a href="control-modebar.html#remove-the-entire-modebar"><i class="fa fa-check"></i><b>26.1</b> Remove the entire modebar</a></li>
<li class="chapter" data-level="26.2" data-path="control-modebar.html"><a href="control-modebar.html#remove-the-plotly-logo"><i class="fa fa-check"></i><b>26.2</b> Remove the plotly logo</a></li>
<li class="chapter" data-level="26.3" data-path="control-modebar.html"><a href="control-modebar.html#remove-modebar-buttons-by-name"><i class="fa fa-check"></i><b>26.3</b> Remove modebar buttons by name</a></li>
<li class="chapter" data-level="26.4" data-path="control-modebar.html"><a href="control-modebar.html#add-custom-modebar-buttons"><i class="fa fa-check"></i><b>26.4</b> Add custom modebar buttons</a></li>
<li class="chapter" data-level="26.5" data-path="control-modebar.html"><a href="control-modebar.html#control-image-downloads"><i class="fa fa-check"></i><b>26.5</b> Control image downloads</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="working-with-colors.html"><a href="working-with-colors.html"><i class="fa fa-check"></i><b>27</b> Working with colors</a></li>
<li class="chapter" data-level="28" data-path="working-with-symbols.html"><a href="working-with-symbols.html"><i class="fa fa-check"></i><b>28</b> Working with symbols and glyphs</a></li>
<li class="chapter" data-level="29" data-path="embedding-images.html"><a href="embedding-images.html"><i class="fa fa-check"></i><b>29</b> Embedding images</a></li>
<li class="chapter" data-level="30" data-path="locales.html"><a href="locales.html"><i class="fa fa-check"></i><b>30</b> Language support</a></li>
<li class="chapter" data-level="31" data-path="mathjax.html"><a href="mathjax.html"><i class="fa fa-check"></i><b>31</b> LaTeX rendering</a>
<ul>
<li class="chapter" data-level="31.1" data-path="mathjax.html"><a href="mathjax.html#mathjax-caveats"><i class="fa fa-check"></i><b>31.1</b> MathJax caveats</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="the-data-plot-pipeline.html"><a href="the-data-plot-pipeline.html"><i class="fa fa-check"></i><b>32</b> The data-plot-pipeline</a></li>
<li class="chapter" data-level="33" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html"><i class="fa fa-check"></i><b>33</b> Improving <code>ggplotly()</code></a>
<ul>
<li class="chapter" data-level="33.1" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#modifying-layout"><i class="fa fa-check"></i><b>33.1</b> Modifying layout</a></li>
<li class="chapter" data-level="33.2" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#modifying-data"><i class="fa fa-check"></i><b>33.2</b> Modifying data</a></li>
<li class="chapter" data-level="33.3" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#leveraging-statistical-output"><i class="fa fa-check"></i><b>33.3</b> Leveraging statistical output</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="custom-geoms.html"><a href="custom-geoms.html"><i class="fa fa-check"></i><b>34</b> Translating custom ggplot2 geoms</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Interactive web-based data visualization with R, plotly, and shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="maps" class="section level1">
<h1><span class="header-section-number">4</span> Maps</h1>
<p>There are numerous ways to make a map with <strong>plotly</strong> – each with it’s own strengths and weaknesses. Generally speaking the approaches fall under two categories: integrated or custom. Integrated maps leverage plotly.js’ built-in support for rendering a basemap layer. Currently there are two supported ways of making integrated maps: either via <a href="https://www.mapbox.com/">Mapbox</a> or via an integrated d3.js powered basemap. The integrated approach is convenient if you need a quick map and don’t necessarily need sophisticated representations of geo-spatial objects. On the other hand, the custom mapping approach offers complete control since you’re providing all the information necessary to render the geo-spatial object(s). Section <a href="maps.html#maps-custom">4.2</a> covers making sophisticated maps (e.g., cartograms) using the <strong>sf</strong> R package, but it’s also possible to make custom <strong>plotly</strong> maps via other tools for geo-computing (e.g., <strong>sp</strong>, <strong>ggmap</strong>, etc).</p>
<p>It’s worth noting that <strong>plotly</strong> aims to be a general purpose visualization library, and thus, doesn’t aim to be the most fully featured geo-spatial visualization toolkit. That said, there are benefits to using <strong>plotly</strong>-based maps since the mapping APIs are very similar to the rest of plotly, and you can leverage larger <strong>plotly</strong> ecosystem (e.g., linking views client side like Figure <a href="client-side-linking.html#fig:mapbox-bars">16.23</a>). However, if you run into limitations with <strong>plotly</strong>’s mapping functionality, there is a very rich set of tools for <a href="https://geocompr.robinlovelace.net/adv-map.html#interactive-maps">interactive geospatial visualization in R</a>, including but not limited to: <strong>leaflet</strong>, <strong>mapview</strong>, <strong>mapedit</strong>, <strong>tmap</strong>, and <strong>mapdeck</strong> <span class="citation">(Robin Lovelace <a href="#ref-geocomputation" role="doc-biblioref">2019</a>)</span>.</p>
<div id="maps-integrated" class="section level2">
<h2><span class="header-section-number">4.1</span> Integrated maps</h2>
<div id="overview-1" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Overview</h3>
<p></p>
<p>If you have fairly simple latitude/longitude data and want to make a quick map, you may want to try one of <strong>plotly</strong>’s integrated mapping options (i.e., <code>plot_mapbox()</code> and <code>plot_geo()</code>). Generally speaking, you can treat these constructor functions as a drop-in replacement for <code>plot_ly()</code> and get a dynamic basemap rendered behind your data. Furthermore, all the scatter-based layers we learned about in Section <a href="scatter-traces.html#scatter-traces">3</a> work as you’d expect it to with <code>plot_ly()</code>.<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> For example, Figure <a href="maps.html#fig:mapbox-bubble">4.1</a> uses <code>plot_mapbox()</code> and <code>add_markers()</code> to create a bubble chart:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="maps.html#cb52-1"></a><span class="kw">plot_mapbox</span>(maps<span class="op">::</span>canada.cities) <span class="op">%&gt;%</span></span>
<span id="cb52-2"><a href="maps.html#cb52-2"></a><span class="st">  </span><span class="kw">add_markers</span>(</span>
<span id="cb52-3"><a href="maps.html#cb52-3"></a>    <span class="dt">x =</span> <span class="op">~</span>long, </span>
<span id="cb52-4"><a href="maps.html#cb52-4"></a>    <span class="dt">y =</span> <span class="op">~</span>lat, </span>
<span id="cb52-5"><a href="maps.html#cb52-5"></a>    <span class="dt">size =</span> <span class="op">~</span>pop, </span>
<span id="cb52-6"><a href="maps.html#cb52-6"></a>    <span class="dt">color =</span> <span class="op">~</span>country.etc,</span>
<span id="cb52-7"><a href="maps.html#cb52-7"></a>    <span class="dt">colors =</span> <span class="st">&quot;Accent&quot;</span>,</span>
<span id="cb52-8"><a href="maps.html#cb52-8"></a>    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, pop),</span>
<span id="cb52-9"><a href="maps.html#cb52-9"></a>    <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span></span>
<span id="cb52-10"><a href="maps.html#cb52-10"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mapbox-bubble"></span>
<iframe src="https://player.vimeo.com/video/317352934?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 4.1: A mapbox powered bubble chart showing the population of various cities in Canada. For the interactive, see <a href="https://plotly-r.com/interactives/mapbox-bubble.html" class="uri">https://plotly-r.com/interactives/mapbox-bubble.html</a>
</p>
</div>
<p></p>
<p>The Mapbox basemap styling is controlled through the <a href="https://plot.ly/r/reference/#layout-mapbox-style"><code>layout.mapbox.style</code></a> attribute. The <strong>plotly</strong> package comes with support for 7 different styles, but you can also supply a custom URL to a <a href="https://docs.mapbox.com/help/tutorials/create-a-custom-style/">custom mapbox style</a>. To obtain all the pre-packaged basemap style names, you can grab them from the official plotly.js <code>schema()</code>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="maps.html#cb53-1"></a>styles &lt;-<span class="st"> </span><span class="kw">schema</span>()<span class="op">$</span>layout<span class="op">$</span>layoutAttributes<span class="op">$</span>mapbox<span class="op">$</span>style<span class="op">$</span>values</span>
<span id="cb53-2"><a href="maps.html#cb53-2"></a>styles</span>
<span id="cb53-3"><a href="maps.html#cb53-3"></a><span class="co">#&gt;  [1] &quot;basic&quot;             &quot;streets&quot;          </span></span>
<span id="cb53-4"><a href="maps.html#cb53-4"></a><span class="co">#&gt;  [3] &quot;outdoors&quot;          &quot;light&quot;            </span></span>
<span id="cb53-5"><a href="maps.html#cb53-5"></a><span class="co">#&gt;  [5] &quot;dark&quot;              &quot;satellite&quot;        </span></span>
<span id="cb53-6"><a href="maps.html#cb53-6"></a><span class="co">#&gt;  [7] &quot;satellite-streets&quot; &quot;open-street-map&quot;  </span></span>
<span id="cb53-7"><a href="maps.html#cb53-7"></a><span class="co">#&gt;  [9] &quot;white-bg&quot;          &quot;carto-positron&quot;   </span></span>
<span id="cb53-8"><a href="maps.html#cb53-8"></a><span class="co">#&gt; [11] &quot;carto-darkmatter&quot;  &quot;stamen-terrain&quot;   </span></span>
<span id="cb53-9"><a href="maps.html#cb53-9"></a><span class="co">#&gt; [13] &quot;stamen-toner&quot;      &quot;stamen-watercolor&quot;</span></span></code></pre></div>
<p>Any one of these values can be used for a mapbox style. Figure <a href="maps.html#fig:satellite">4.2</a> demonstrates the satellite earth imagery basemap.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="maps.html#cb54-1"></a><span class="kw">layout</span>(</span>
<span id="cb54-2"><a href="maps.html#cb54-2"></a>  <span class="kw">plot_mapbox</span>(), </span>
<span id="cb54-3"><a href="maps.html#cb54-3"></a>  <span class="dt">mapbox =</span> <span class="kw">list</span>(<span class="dt">style =</span> <span class="st">&quot;satellite&quot;</span>)</span>
<span id="cb54-4"><a href="maps.html#cb54-4"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:satellite"></span>
<iframe src="https://player.vimeo.com/video/326683897?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 4.2: Zooming in on earth satellite imagery using <code>plot_mapbox()</code>. For the interactive, see <a href="https://plotly-r.com/interactives/satellite.html" class="uri">https://plotly-r.com/interactives/satellite.html</a>
</p>
</div>
<p>Figure <a href="maps.html#fig:mapbox-style-dropdown">4.3</a> demonstrates how to create an integrated plotly.js dropdown menu to control the basemap style via the <a href="https://plot.ly/r/reference/#layout-updatemenus-items-updatemenu-buttons"><code>layout.updatemenus</code></a> attribute. The idea behind an integrated plotly.js dropdown is to supply a list of buttons (i.e., menu items) where each button invokes a plotly.js method with some arguments. In this case, each button uses the <a href="https://plot.ly/javascript/plotlyjs-function-reference/">relayout</a> method to modify the <code>layout.mapbox.style</code> attribute.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
<p></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="maps.html#cb55-1"></a>style_buttons &lt;-<span class="st"> </span><span class="kw">lapply</span>(styles, <span class="cf">function</span>(s) {</span>
<span id="cb55-2"><a href="maps.html#cb55-2"></a>  <span class="kw">list</span>(</span>
<span id="cb55-3"><a href="maps.html#cb55-3"></a>    <span class="dt">label =</span> s, </span>
<span id="cb55-4"><a href="maps.html#cb55-4"></a>    <span class="dt">method =</span> <span class="st">&quot;relayout&quot;</span>, </span>
<span id="cb55-5"><a href="maps.html#cb55-5"></a>    <span class="dt">args =</span> <span class="kw">list</span>(<span class="st">&quot;mapbox.style&quot;</span>, s)</span>
<span id="cb55-6"><a href="maps.html#cb55-6"></a>  )</span>
<span id="cb55-7"><a href="maps.html#cb55-7"></a>})</span>
<span id="cb55-8"><a href="maps.html#cb55-8"></a><span class="kw">layout</span>(</span>
<span id="cb55-9"><a href="maps.html#cb55-9"></a>  <span class="kw">plot_mapbox</span>(), </span>
<span id="cb55-10"><a href="maps.html#cb55-10"></a>  <span class="dt">mapbox =</span> <span class="kw">list</span>(<span class="dt">style =</span> <span class="st">&quot;dark&quot;</span>),</span>
<span id="cb55-11"><a href="maps.html#cb55-11"></a>  <span class="dt">updatemenus =</span> <span class="kw">list</span>(</span>
<span id="cb55-12"><a href="maps.html#cb55-12"></a>    <span class="kw">list</span>(<span class="dt">y =</span> <span class="fl">0.8</span>, <span class="dt">buttons =</span> style_buttons)</span>
<span id="cb55-13"><a href="maps.html#cb55-13"></a>  )</span>
<span id="cb55-14"><a href="maps.html#cb55-14"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mapbox-style-dropdown"></span>
<iframe src="https://player.vimeo.com/video/326684625?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 4.3: Providing a dropdown menu to control the styling of the mapbox baselayer. For the interactive, see <a href="https://plotly-r.com/interactives/mapbox-style-dropdown.html" class="uri">https://plotly-r.com/interactives/mapbox-style-dropdown.html</a>
</p>
</div>
<p></p>
<p>The other integrated mapping solution in <strong>plotly</strong> is <code>plot_geo()</code>. Compared to <code>plot_mapbox()</code>, this approach has support for different mapping projections, but styling the basemap is limited and can be more cumbersome. Figure <a href="maps.html#fig:geo-flights">4.4</a> demonstrates using <code>plot_geo()</code> in conjunction with <code>add_markers()</code> and <code>add_segments()</code> to visualize flight paths within the United States. Whereas <code>plot_mapbox()</code> is fixed to a mercator projection, the <code>plot_geo()</code> constructor has a handful of different projection available to it, including the orthographic projection which gives the illusion of the 3D globe.</p>
<p></p>
<details>
<p><summary>Click to show code</summary></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="maps.html#cb56-1"></a><span class="kw">library</span>(plotly)</span>
<span id="cb56-2"><a href="maps.html#cb56-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb56-3"><a href="maps.html#cb56-3"></a><span class="co"># airport locations</span></span>
<span id="cb56-4"><a href="maps.html#cb56-4"></a>air &lt;-<span class="st"> </span><span class="kw">read.csv</span>(</span>
<span id="cb56-5"><a href="maps.html#cb56-5"></a>  <span class="st">&#39;https://plotly-r.com/data-raw/airport_locations.csv&#39;</span></span>
<span id="cb56-6"><a href="maps.html#cb56-6"></a>)</span>
<span id="cb56-7"><a href="maps.html#cb56-7"></a><span class="co"># flights between airports</span></span>
<span id="cb56-8"><a href="maps.html#cb56-8"></a>flights &lt;-<span class="st"> </span><span class="kw">read.csv</span>(</span>
<span id="cb56-9"><a href="maps.html#cb56-9"></a>  <span class="st">&#39;https://plotly-r.com/data-raw/flight_paths.csv&#39;</span></span>
<span id="cb56-10"><a href="maps.html#cb56-10"></a>)</span>
<span id="cb56-11"><a href="maps.html#cb56-11"></a>flights<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">seq_len</span>(<span class="kw">nrow</span>(flights))</span>
<span id="cb56-12"><a href="maps.html#cb56-12"></a></span>
<span id="cb56-13"><a href="maps.html#cb56-13"></a><span class="co"># map projection</span></span>
<span id="cb56-14"><a href="maps.html#cb56-14"></a>geo &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb56-15"><a href="maps.html#cb56-15"></a>  <span class="dt">projection =</span> <span class="kw">list</span>(</span>
<span id="cb56-16"><a href="maps.html#cb56-16"></a>    <span class="dt">type =</span> <span class="st">&#39;orthographic&#39;</span>,</span>
<span id="cb56-17"><a href="maps.html#cb56-17"></a>    <span class="dt">rotation =</span> <span class="kw">list</span>(<span class="dt">lon =</span> <span class="dv">-100</span>, <span class="dt">lat =</span> <span class="dv">40</span>, <span class="dt">roll =</span> <span class="dv">0</span>)</span>
<span id="cb56-18"><a href="maps.html#cb56-18"></a>  ),</span>
<span id="cb56-19"><a href="maps.html#cb56-19"></a>  <span class="dt">showland =</span> <span class="ot">TRUE</span>,</span>
<span id="cb56-20"><a href="maps.html#cb56-20"></a>  <span class="dt">landcolor =</span> <span class="kw">toRGB</span>(<span class="st">&quot;gray95&quot;</span>),</span>
<span id="cb56-21"><a href="maps.html#cb56-21"></a>  <span class="dt">countrycolor =</span> <span class="kw">toRGB</span>(<span class="st">&quot;gray80&quot;</span>)</span>
<span id="cb56-22"><a href="maps.html#cb56-22"></a>)</span>
<span id="cb56-23"><a href="maps.html#cb56-23"></a></span>
<span id="cb56-24"><a href="maps.html#cb56-24"></a><span class="kw">plot_geo</span>(<span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;red&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb56-25"><a href="maps.html#cb56-25"></a><span class="st">  </span><span class="kw">add_markers</span>(</span>
<span id="cb56-26"><a href="maps.html#cb56-26"></a>    <span class="dt">data =</span> air, <span class="dt">x =</span> <span class="op">~</span>long, <span class="dt">y =</span> <span class="op">~</span>lat, <span class="dt">text =</span> <span class="op">~</span>airport,</span>
<span id="cb56-27"><a href="maps.html#cb56-27"></a>    <span class="dt">size =</span> <span class="op">~</span>cnt, <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb56-28"><a href="maps.html#cb56-28"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb56-29"><a href="maps.html#cb56-29"></a><span class="st">  </span><span class="kw">add_segments</span>(</span>
<span id="cb56-30"><a href="maps.html#cb56-30"></a>    <span class="dt">data =</span> <span class="kw">group_by</span>(flights, id),</span>
<span id="cb56-31"><a href="maps.html#cb56-31"></a>    <span class="dt">x =</span> <span class="op">~</span>start_lon, <span class="dt">xend =</span> <span class="op">~</span>end_lon,</span>
<span id="cb56-32"><a href="maps.html#cb56-32"></a>    <span class="dt">y =</span> <span class="op">~</span>start_lat, <span class="dt">yend =</span> <span class="op">~</span>end_lat,</span>
<span id="cb56-33"><a href="maps.html#cb56-33"></a>    <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="kw">I</span>(<span class="dv">1</span>), <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb56-34"><a href="maps.html#cb56-34"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb56-35"><a href="maps.html#cb56-35"></a><span class="st">  </span><span class="kw">layout</span>(<span class="dt">geo =</span> geo, <span class="dt">showlegend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
</details>
<div class="figure" style="text-align: center"><span id="fig:geo-flights"></span>
<iframe src="https://player.vimeo.com/video/317358033?title=0&amp;byline=0&amp;portrait=0" width="100%" height="400" frameborder="0" seamless="seamless" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
<p class="caption">
FIGURE 4.4: Using the integrated orthographic projection to visualize flight patterns on a ‘3D’ globe. For the interactive, see <a href="https://plotly-r.com/interactives/geo-flights.html" class="uri">https://plotly-r.com/interactives/geo-flights.html</a>
</p>
</div>
<p>One nice thing about <code>plot_geo()</code> is that it automatically projects geometries into the proper coordinate system defined by the map projection. For example, in Figure <a href="maps.html#fig:maps">4.5</a> the simple line segment is straight when using <code>plot_mapbox()</code> yet curved when using <code>plot_geo()</code>. It’s possible to achieve the same effect using <code>plot_ly()</code> or <code>plot_mapbox()</code>, but the relevant marker/line/polygon data has to be put into an <strong>sf</strong> data structure before rendering (see Section <a href="maps.html#sf">4.2.1</a> for more details).</p>
<p>
</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="maps.html#cb57-1"></a>map1 &lt;-<span class="st"> </span><span class="kw">plot_mapbox</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-2"><a href="maps.html#cb57-2"></a><span class="st">  </span><span class="kw">add_segments</span>(<span class="dt">x =</span> <span class="dv">-100</span>, <span class="dt">xend =</span> <span class="dv">-50</span>, <span class="dt">y =</span> <span class="dv">50</span>, <span class="dt">yend =</span> <span class="dv">75</span>) <span class="op">%&gt;%</span></span>
<span id="cb57-3"><a href="maps.html#cb57-3"></a><span class="st">  </span><span class="kw">layout</span>(</span>
<span id="cb57-4"><a href="maps.html#cb57-4"></a>    <span class="dt">mapbox =</span> <span class="kw">list</span>(</span>
<span id="cb57-5"><a href="maps.html#cb57-5"></a>      <span class="dt">zoom =</span> <span class="dv">0</span>,</span>
<span id="cb57-6"><a href="maps.html#cb57-6"></a>      <span class="dt">center =</span> <span class="kw">list</span>(<span class="dt">lat =</span> <span class="dv">65</span>, <span class="dt">lon =</span> <span class="dv">-75</span>)</span>
<span id="cb57-7"><a href="maps.html#cb57-7"></a>    )</span>
<span id="cb57-8"><a href="maps.html#cb57-8"></a>  )</span>
<span id="cb57-9"><a href="maps.html#cb57-9"></a></span>
<span id="cb57-10"><a href="maps.html#cb57-10"></a>map2 &lt;-<span class="st"> </span><span class="kw">plot_geo</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-11"><a href="maps.html#cb57-11"></a><span class="st">  </span><span class="kw">add_segments</span>(<span class="dt">x =</span> <span class="dv">-100</span>, <span class="dt">xend =</span> <span class="dv">-50</span>, <span class="dt">y =</span> <span class="dv">50</span>, <span class="dt">yend =</span> <span class="dv">75</span>) <span class="op">%&gt;%</span></span>
<span id="cb57-12"><a href="maps.html#cb57-12"></a><span class="st">  </span><span class="kw">layout</span>(<span class="dt">geo =</span> <span class="kw">list</span>(<span class="dt">projection =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;mercator&quot;</span>)))</span>
<span id="cb57-13"><a href="maps.html#cb57-13"></a></span>
<span id="cb57-14"><a href="maps.html#cb57-14"></a><span class="kw">library</span>(htmltools)</span>
<span id="cb57-15"><a href="maps.html#cb57-15"></a><span class="kw">browsable</span>(<span class="kw">tagList</span>(map1, map2))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:maps"></span>
<img src="images/maps.png" alt="A comparison of plotly’s integrated mapping solutions: plot_mapbox() (top) and plot_geo() (bottom). The plot_geo() approach will transform line segments to correctly reflect their projection into a non-cartesian coordinate system." width="100%" data-url="/interactives/maps.html" />
<p class="caption">
FIGURE 4.5: A comparison of <strong>plotly</strong>’s integrated mapping solutions: <code>plot_mapbox()</code> (top) and <code>plot_geo()</code> (bottom). The <code>plot_geo()</code> approach will transform line segments to correctly reflect their projection into a non-cartesian coordinate system.
</p>
</div>
</div>
<div id="choropleths" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Choropleths</h3>
<p></p>
<p>In addition to scatter traces, both of the integrated mapping solutions (i.e., <code>plot_mapbox()</code> and <code>plot_geo()</code>) have an optimized choropleth trace type (i.e., the <a href="https://plot.ly/r/reference/#choroplethmapbox">choroplethmapbox</a> and <a href="https://plot.ly/r/reference/#choropleth">choropleth</a> trace types). Comparatively speaking, choroplethmapbox is more powerful because you can fully specify the feature collection using GeoJSON, but the choropleth trace can be a bit easier to use if it fits your use case.</p>
<p>Figure <a href="maps.html#fig:us-density">4.6</a> shows the population density of the U.S. via the choropleth trace using the U.S. state data from the <strong>datasets</strong> package <span class="citation">(R Core Team <a href="#ref-RCore" role="doc-biblioref">2016</a>)</span>. By simply providing a <a href="https://plot.ly/r/reference/#choropleth-z"><code>z</code></a> attribute, <code>plotly_geo()</code> objects will try to create a choropleth, but you’ll also need to provide <a href="https://plot.ly/r/reference/#choropleth-locations"><code>locations</code></a> and a <a href="https://plot.ly/r/reference/#choropleth-locationmode"><code>locationmode</code></a>. It’s worth noting that the <code>locationmode</code> is currently limited to countries and US states, so if you need to a different geo-unit (e.g., counties, municipalities, etc), you should use the choroplethmapbox trace type and/or use a “custom” mapping approach as discussed in Section <a href="maps.html#maps-custom">4.2</a>.</p>
<p></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="maps.html#cb58-1"></a>density &lt;-<span class="st"> </span>state.x77[, <span class="st">&quot;Population&quot;</span>] <span class="op">/</span><span class="st"> </span>state.x77[, <span class="st">&quot;Area&quot;</span>]</span>
<span id="cb58-2"><a href="maps.html#cb58-2"></a></span>
<span id="cb58-3"><a href="maps.html#cb58-3"></a>g &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb58-4"><a href="maps.html#cb58-4"></a>  <span class="dt">scope =</span> <span class="st">&#39;usa&#39;</span>,</span>
<span id="cb58-5"><a href="maps.html#cb58-5"></a>  <span class="dt">projection =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&#39;albers usa&#39;</span>),</span>
<span id="cb58-6"><a href="maps.html#cb58-6"></a>  <span class="dt">lakecolor =</span> <span class="kw">toRGB</span>(<span class="st">&#39;white&#39;</span>)</span>
<span id="cb58-7"><a href="maps.html#cb58-7"></a>)</span>
<span id="cb58-8"><a href="maps.html#cb58-8"></a></span>
<span id="cb58-9"><a href="maps.html#cb58-9"></a><span class="kw">plot_geo</span>() <span class="op">%&gt;%</span></span>
<span id="cb58-10"><a href="maps.html#cb58-10"></a><span class="st">  </span><span class="kw">add_trace</span>(</span>
<span id="cb58-11"><a href="maps.html#cb58-11"></a>    <span class="dt">z =</span> <span class="op">~</span>density, <span class="dt">text =</span> state.name, <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">0</span>),</span>
<span id="cb58-12"><a href="maps.html#cb58-12"></a>    <span class="dt">locations =</span> state.abb, <span class="dt">locationmode =</span> <span class="st">&#39;USA-states&#39;</span></span>
<span id="cb58-13"><a href="maps.html#cb58-13"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb58-14"><a href="maps.html#cb58-14"></a><span class="st">  </span><span class="kw">layout</span>(<span class="dt">geo =</span> g)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:us-density"></span>
<img src="images/us-density.svg" alt="A map of U.S. population density using the state.x77 data from the datasets package." width="100%" data-url="/interactives/us-density.html" />
<p class="caption">
FIGURE 4.6: A map of U.S. population density using the <code>state.x77</code> data from the <strong>datasets</strong> package.
</p>
</div>
<p>Choroplethmapbox is more flexible than choropleth because you supply your own GeoJSON definition of the choropleth via the <code>geojson</code> attribute. Currently this attribute must be a URL pointing to a geojson file. Moreover, the <code>location</code> should point to a top-level id attribute of each feature within the geojson file. Figure <a href="maps.html#fig:us-density-geojson">4.7</a> demonstrates how we could visualize the same information as Figure <a href="maps.html#fig:us-density">4.6</a>, but this time using choroplethmapbox.</p>
<p></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="maps.html#cb59-1"></a><span class="kw">plot_ly</span>() <span class="op">%&gt;%</span></span>
<span id="cb59-2"><a href="maps.html#cb59-2"></a><span class="st">  </span><span class="kw">add_trace</span>(</span>
<span id="cb59-3"><a href="maps.html#cb59-3"></a>    <span class="dt">type =</span> <span class="st">&quot;choroplethmapbox&quot;</span>,</span>
<span id="cb59-4"><a href="maps.html#cb59-4"></a>    <span class="co"># See how this GeoJSON URL was generated at</span></span>
<span id="cb59-5"><a href="maps.html#cb59-5"></a>    <span class="co"># https://plotly-r.com/data-raw/us-states.R</span></span>
<span id="cb59-6"><a href="maps.html#cb59-6"></a>    <span class="dt">geojson =</span> <span class="kw">paste</span>(<span class="kw">c</span>(</span>
<span id="cb59-7"><a href="maps.html#cb59-7"></a>      <span class="st">&quot;https://gist.githubusercontent.com/cpsievert/&quot;</span>,</span>
<span id="cb59-8"><a href="maps.html#cb59-8"></a>      <span class="st">&quot;7cdcb444fb2670bd2767d349379ae886/raw/&quot;</span>,</span>
<span id="cb59-9"><a href="maps.html#cb59-9"></a>      <span class="st">&quot;cf5631bfd2e385891bb0a9788a179d7f023bf6c8/&quot;</span>, </span>
<span id="cb59-10"><a href="maps.html#cb59-10"></a>      <span class="st">&quot;us-states.json&quot;</span></span>
<span id="cb59-11"><a href="maps.html#cb59-11"></a>    ), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb59-12"><a href="maps.html#cb59-12"></a>    <span class="dt">locations =</span> <span class="kw">row.names</span>(state.x77),</span>
<span id="cb59-13"><a href="maps.html#cb59-13"></a>    <span class="dt">z =</span> state.x77[, <span class="st">&quot;Population&quot;</span>] <span class="op">/</span><span class="st"> </span>state.x77[, <span class="st">&quot;Area&quot;</span>],</span>
<span id="cb59-14"><a href="maps.html#cb59-14"></a>    <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">0</span>)</span>
<span id="cb59-15"><a href="maps.html#cb59-15"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb59-16"><a href="maps.html#cb59-16"></a><span class="st">  </span><span class="kw">layout</span>(</span>
<span id="cb59-17"><a href="maps.html#cb59-17"></a>    <span class="dt">mapbox =</span> <span class="kw">list</span>(</span>
<span id="cb59-18"><a href="maps.html#cb59-18"></a>      <span class="dt">style =</span> <span class="st">&quot;light&quot;</span>,</span>
<span id="cb59-19"><a href="maps.html#cb59-19"></a>      <span class="dt">zoom =</span> <span class="dv">4</span>,</span>
<span id="cb59-20"><a href="maps.html#cb59-20"></a>      <span class="dt">center =</span> <span class="kw">list</span>(<span class="dt">lon =</span> <span class="fl">-98.58</span>, <span class="dt">lat =</span> <span class="fl">39.82</span>)</span>
<span id="cb59-21"><a href="maps.html#cb59-21"></a>    )</span>
<span id="cb59-22"><a href="maps.html#cb59-22"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb59-23"><a href="maps.html#cb59-23"></a><span class="st">  </span><span class="kw">config</span>(</span>
<span id="cb59-24"><a href="maps.html#cb59-24"></a>    <span class="dt">mapboxAccessToken =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;MAPBOX_TOKEN&quot;</span>),</span>
<span id="cb59-25"><a href="maps.html#cb59-25"></a>    <span class="co"># Workaround to make sure image download uses full container</span></span>
<span id="cb59-26"><a href="maps.html#cb59-26"></a>    <span class="co"># size https://github.com/plotly/plotly.js/pull/3746</span></span>
<span id="cb59-27"><a href="maps.html#cb59-27"></a>    <span class="dt">toImageButtonOptions =</span> <span class="kw">list</span>(</span>
<span id="cb59-28"><a href="maps.html#cb59-28"></a>      <span class="dt">format =</span> <span class="st">&quot;svg&quot;</span>, </span>
<span id="cb59-29"><a href="maps.html#cb59-29"></a>      <span class="dt">width =</span> <span class="ot">NULL</span>, </span>
<span id="cb59-30"><a href="maps.html#cb59-30"></a>      <span class="dt">height =</span> <span class="ot">NULL</span></span>
<span id="cb59-31"><a href="maps.html#cb59-31"></a>    )</span>
<span id="cb59-32"><a href="maps.html#cb59-32"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:us-density-geojson"></span>
<img src="images/us-density-geojson.svg" alt="Another map of U.S. population density, this time using choroplethmapbox with a custom GeoJSON file." width="100%" data-url="/interactives/us-density-geojson.html" />
<p class="caption">
FIGURE 4.7: Another map of U.S. population density, this time using choroplethmapbox with a custom GeoJSON file.
</p>
</div>
<p>Figures <a href="maps.html#fig:us-density">4.6</a> and <a href="maps.html#fig:us-density-geojson">4.7</a> aren’t an ideal way to visualize state population a graphical perception point of view. We typically use the color in choropleths to encode a numeric variable (e.g., GDP, net exports, average SAT score, etc) and the eye naturally perceives the area that a particular color covers as proportional to its overall effect. This ends up being misleading since the area the color covers typically has no sensible relationship with the data encoded by the color. A classic example of this misleading effect in action is in US election maps – the proportion of red to blue coloring is not representative of the overall popular vote <span class="citation">(Newman <a href="#ref-election-maps" role="doc-biblioref">2016</a>)</span>.</p>
<p>Cartograms are an approach to reducing this misleading effect and grants another dimension to encode data through the size of geo-spatial features. Section <a href="maps.html#cartograms">4.2.2</a> covers how to render cartograms in <strong>plotly</strong> using <strong>sf</strong> and <strong>cartogram</strong>.</p>
</div>
</div>
<div id="maps-custom" class="section level2">
<h2><span class="header-section-number">4.2</span> Custom maps</h2>
<div id="sf" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Simple features (sf)</h3>
<p>The <strong>sf</strong> R package is a modern approach to working with geo-spatial data structures based on tidy data principles <span class="citation">(Pebesma <a href="#ref-sf" role="doc-biblioref">2018</a>; Wickham <a href="#ref-tidy-data" role="doc-biblioref">2014</a><a href="#ref-tidy-data" role="doc-biblioref">b</a>)</span>. The key idea behind <strong>sf</strong> is that it stores geo-spatial geometries in a <a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html">list-column</a> of a data frame. This allows each row to represent the real unit of observation/interest – whether it’s a polygon, multi-polygon, point, line, or even a collection of these features – and as a result, works seamlessly inside larger tidy workflows.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> The <strong>sf</strong> package itself does not really provide geo-spatial data – it provides the framework and utilities for storing and computing on geo-spatial data structures in an opinionated way.</p>
<p>There are numerous packages for accessing geo-spatial data as simple features data structures. A couple notable examples include <strong>rnaturalearth</strong> and <strong>USAboundaries</strong>. The <strong>rnaturalearth</strong> package is better for obtaining any map data in the world via an API provided by <a href="https://www.naturalearthdata.com/" class="uri">https://www.naturalearthdata.com/</a> <span class="citation">(South <a href="#ref-rnaturalearth" role="doc-biblioref">2017</a>)</span>. The <strong>USAboundaries</strong> package is great for obtaining map data for the United States at any point in history <span class="citation">(Mullen and Bratt <a href="#ref-USAboundaries" role="doc-biblioref">2018</a>)</span>. It doesn’t really matter what tool you use to obtain or create an <strong>sf</strong> object – once you have one, <code>plot_ly()</code> knows how to render it:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="maps.html#cb60-1"></a><span class="kw">library</span>(rnaturalearth)</span>
<span id="cb60-2"><a href="maps.html#cb60-2"></a>world &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span>
<span id="cb60-3"><a href="maps.html#cb60-3"></a><span class="kw">class</span>(world)</span>
<span id="cb60-4"><a href="maps.html#cb60-4"></a><span class="co">#&gt; [1] &quot;sf&quot;    &quot;data.frame&quot;</span></span>
<span id="cb60-5"><a href="maps.html#cb60-5"></a><span class="kw">plot_ly</span>(world, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray90&quot;</span>), <span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:world"></span>
<img src="images/world.svg" alt="Rendering all the world’s countries using plot_ly() and the ne_countries() function from the rnaturalearth package." width="100%" data-url="/interactives/world.html" />
<p class="caption">
FIGURE 4.8: Rendering all the world’s countries using <code>plot_ly()</code> and the <code>ne_countries()</code> function from the <strong>rnaturalearth</strong> package.
</p>
</div>
<p>How does <code>plot_ly()</code> know how to render the countries? It’s because the geo-spatial features are encoded in special (geometry) list-column. Also, meta-data about the geo-spatial structure are retained as special attributes of the data. Figure <a href="maps.html#fig:view-sf">4.9</a> augments the print method for <strong>sf</strong> to data frames to demonstrate that all the information needed to render the countries (i.e., polygons) in Figure <a href="maps.html#fig:world">4.8</a> is contained within the <code>world</code> data frame. Note also, that <strong>sf</strong> provides special <strong>dplyr</strong> methods for this special class of data frame so that you can treat data manipulations as if it were a ‘tidy’ data structure. One thing about this method is that the special ‘geometry’ column is always retained – if we try to just select the <code>name</code> column, then we get both the name and the geometry.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="maps.html#cb61-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb61-2"><a href="maps.html#cb61-2"></a>world <span class="op">%&gt;%</span></span>
<span id="cb61-3"><a href="maps.html#cb61-3"></a><span class="st">  </span><span class="kw">select</span>(name) <span class="op">%&gt;%</span></span>
<span id="cb61-4"><a href="maps.html#cb61-4"></a><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">4</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:view-sf"></span>
<img src="images/view-sf.svg" alt="A diagram of a simple features data frame. The geometry column tracks the spatial features attached to each row in the data frame." width="100%" />
<p class="caption">
FIGURE 4.9: A diagram of a simple features data frame. The geometry column tracks the spatial features attached to each row in the data frame.
</p>
</div>
<p>There are actually 4 different ways to render <strong>sf</strong> objects with <strong>plotly</strong>: <code>plot_ly()</code>, <code>plot_mapbox()</code>, <code>plot_geo()</code>, and via <strong>ggplot2</strong>’s <code>geom_sf()</code>. These functions render multiple polygons using a <em>single</em> trace by default, which is fast, but you may want to leverage the added flexibility of multiple traces. For example, a given trace can only have one <code>fillcolor</code>, so it’s impossible to render multiple polygons with different colors using a single trace. For this reason, if you want to vary the color of multiple polygons, make sure the <code>split</code> by a unique identifier (e.g. <code>name</code>), as done in Figure <a href="maps.html#fig:split-color">4.10</a>. Note that, as discussed for line charts in Figure <a href="scatter-traces.html#fig:scatter-lines">3.2</a>, using multiple traces automatically adds the ability to filter <code>name</code> via legend entries.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="maps.html#cb62-1"></a>canada &lt;-<span class="st"> </span><span class="kw">ne_states</span>(<span class="dt">country =</span> <span class="st">&quot;Canada&quot;</span>, <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span>
<span id="cb62-2"><a href="maps.html#cb62-2"></a><span class="kw">plot_ly</span>(canada, <span class="dt">split =</span> <span class="op">~</span>name, <span class="dt">color =</span> <span class="op">~</span>provnum_ne)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:split-color"></span>
<img src="images/split-color.svg" alt="Using split and color to create a choropleth map of provinces in Canada." width="100%" data-url="/interactives/split-color.html" />
<p class="caption">
FIGURE 4.10: Using <code>split</code> and <code>color</code> to create a choropleth map of provinces in Canada.
</p>
</div>
<p>Another important feature for maps that may require you to <code>split</code> multiple polygons into multiple traces is the ability to display a different hover-on-fill for each polygon. By providing <code>text</code> that is unique within each polygon and specifying <code>hoveron='fills'</code>, the tooltip behavior is tied to the trace’s fill (instead of displayed at each point along the polygon).</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="maps.html#cb63-1"></a><span class="kw">plot_ly</span>(</span>
<span id="cb63-2"><a href="maps.html#cb63-2"></a>  canada, </span>
<span id="cb63-3"><a href="maps.html#cb63-3"></a>  <span class="dt">split =</span> <span class="op">~</span>name, </span>
<span id="cb63-4"><a href="maps.html#cb63-4"></a>  <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray90&quot;</span>), </span>
<span id="cb63-5"><a href="maps.html#cb63-5"></a>  <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, <span class="st">&quot;is </span><span class="ch">\n</span><span class="st"> province number&quot;</span>, provnum_ne),</span>
<span id="cb63-6"><a href="maps.html#cb63-6"></a>  <span class="dt">hoveron =</span> <span class="st">&quot;fills&quot;</span>,</span>
<span id="cb63-7"><a href="maps.html#cb63-7"></a>  <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb63-8"><a href="maps.html#cb63-8"></a>  <span class="dt">showlegend =</span> <span class="ot">FALSE</span></span>
<span id="cb63-9"><a href="maps.html#cb63-9"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:split-text"></span>
<img src="images/split-text.png" alt="Using split, text, and hoveron='fills' to display a tooltip specific to each Canadian province." width="100%" data-url="/interactives/split-text.html" />
<p class="caption">
FIGURE 4.11: Using <code>split</code>, <code>text</code>, and <code>hoveron='fills'</code> to display a tooltip specific to each Canadian province.
</p>
</div>
<p>Although the integrated mapping approaches (<code>plot_mapbox()</code> and <code>plot_geo()</code>) can render <strong>sf</strong> objects, the custom mapping approaches (<code>plot_ly()</code> and <code>geom_sf()</code>) are more flexible because they allow for any well-defined mapping projection. Working with and understanding map projections can be intimidating for a causal map maker. Thankfully, there are nice resources for searching map projections in a human-friendly interface, like <a href="http://spatialreference.org/" class="uri">http://spatialreference.org/</a>. Through this website, one can search desirable projections for a given portion of the globe and extract commands for projecting their geo-spatial objects into that projection. One way to perform the projection is to supply the relevant PROJ4 command to the <code>st_transform()</code> function in <strong>sf</strong> <span class="citation">(PROJ contributors <a href="#ref-PROJ" role="doc-biblioref">2018</a>)</span>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="maps.html#cb64-1"></a><span class="co"># filter the world sf object down to canada</span></span>
<span id="cb64-2"><a href="maps.html#cb64-2"></a>canada &lt;-<span class="st"> </span><span class="kw">filter</span>(world, name <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</span>
<span id="cb64-3"><a href="maps.html#cb64-3"></a><span class="co"># coerce cities lat/long data to an official sf object</span></span>
<span id="cb64-4"><a href="maps.html#cb64-4"></a>cities &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(</span>
<span id="cb64-5"><a href="maps.html#cb64-5"></a>  maps<span class="op">::</span>canada.cities, </span>
<span id="cb64-6"><a href="maps.html#cb64-6"></a>  <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb64-7"><a href="maps.html#cb64-7"></a>  <span class="dt">crs =</span> <span class="dv">4326</span></span>
<span id="cb64-8"><a href="maps.html#cb64-8"></a>)</span>
<span id="cb64-9"><a href="maps.html#cb64-9"></a></span>
<span id="cb64-10"><a href="maps.html#cb64-10"></a><span class="co"># A PROJ4 projection designed for Canada</span></span>
<span id="cb64-11"><a href="maps.html#cb64-11"></a><span class="co"># http://spatialreference.org/ref/sr-org/7/</span></span>
<span id="cb64-12"><a href="maps.html#cb64-12"></a><span class="co"># http://spatialreference.org/ref/sr-org/7/proj4/</span></span>
<span id="cb64-13"><a href="maps.html#cb64-13"></a>moll_proj &lt;-<span class="st"> &quot;+proj=moll +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 </span></span>
<span id="cb64-14"><a href="maps.html#cb64-14"></a><span class="st">+units=m +no_defs&quot;</span></span>
<span id="cb64-15"><a href="maps.html#cb64-15"></a></span>
<span id="cb64-16"><a href="maps.html#cb64-16"></a><span class="co"># perform the projections</span></span>
<span id="cb64-17"><a href="maps.html#cb64-17"></a>canada &lt;-<span class="st"> </span><span class="kw">st_transform</span>(canada, moll_proj)</span>
<span id="cb64-18"><a href="maps.html#cb64-18"></a>cities &lt;-<span class="st"> </span><span class="kw">st_transform</span>(cities, moll_proj)</span>
<span id="cb64-19"><a href="maps.html#cb64-19"></a></span>
<span id="cb64-20"><a href="maps.html#cb64-20"></a><span class="co"># plot with geom_sf()</span></span>
<span id="cb64-21"><a href="maps.html#cb64-21"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb64-22"><a href="maps.html#cb64-22"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> canada) <span class="op">+</span></span>
<span id="cb64-23"><a href="maps.html#cb64-23"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> cities, <span class="kw">aes</span>(<span class="dt">size =</span> pop), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>)</span>
<span id="cb64-24"><a href="maps.html#cb64-24"></a><span class="kw">ggplotly</span>(p)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:canada-ggplotly"></span>
<img src="images/canada-ggplotly.svg" alt="The population of various Canadian cities rendered on a custom basemap using a Mollweide projection." width="100%" data-url="/interactives/canada-ggplotly.html" />
<p class="caption">
FIGURE 4.12: The population of various Canadian cities rendered on a custom basemap using a Mollweide projection.
</p>
</div>
<p>Some geo-spatial objects have an unnecessarily high resolution for a given visualization. In these cases, you may want to consider simplifying the geo-spatial object to improve the speed of the R code and responsiveness of the visualization. For example, we could recreate Figure <a href="maps.html#fig:world">4.8</a> with a much higher resolution by specifying <code>scale = "large"</code> in <code>ne_countries()</code> this gives us a <strong>sf</strong> object with over 50 times more spatial coordinates than the default scale. The higher resolution allows us to zoom in better on more complex geo-spatial regions, but it allow leads to slower R code, larger HTML files, and slower responsiveness. <span class="citation">Sievert (<a href="#ref-ggplotly-blog-post" role="doc-biblioref">2018</a><a href="#ref-ggplotly-blog-post" role="doc-biblioref">b</a>)</span> explores this issue in more depth and demonstrates how to use the <code>st_simplify()</code> function from <strong>sf</strong> to simplify features before plotting them.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="maps.html#cb65-1"></a><span class="kw">sum</span>(<span class="kw">rapply</span>(world<span class="op">$</span>geometry, nrow))</span>
<span id="cb65-2"><a href="maps.html#cb65-2"></a><span class="co">#&gt; [1] 10586</span></span>
<span id="cb65-3"><a href="maps.html#cb65-3"></a></span>
<span id="cb65-4"><a href="maps.html#cb65-4"></a>world_large &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">scale =</span> <span class="st">&quot;large&quot;</span>, <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</span>
<span id="cb65-5"><a href="maps.html#cb65-5"></a><span class="kw">sum</span>(<span class="kw">rapply</span>(world_large<span class="op">$</span>geometry, nrow))</span>
<span id="cb65-6"><a href="maps.html#cb65-6"></a><span class="co">#&gt; [1] 548121</span></span></code></pre></div>
<p>Analogous to the discussion surrounding <a href="scatter-traces.html#fig:scatter-lines">3.2</a>, it pays to be aware of the tradeoffs involved with rendering <strong>plotly</strong> graphics using one or many traces, and knowledgeable about how to leverage either approach. Specifically, by default, <strong>plotly</strong> attempts to render all simple features in a single trace, which is performant, but doesn’t have a lot of interactivity.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="maps.html#cb66-1"></a><span class="kw">plot_mapbox</span>(</span>
<span id="cb66-2"><a href="maps.html#cb66-2"></a>  world_large, </span>
<span id="cb66-3"><a href="maps.html#cb66-3"></a>  <span class="dt">color =</span> <span class="ot">NA</span>, </span>
<span id="cb66-4"><a href="maps.html#cb66-4"></a>  <span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), </span>
<span id="cb66-5"><a href="maps.html#cb66-5"></a>  <span class="dt">span =</span> <span class="kw">I</span>(<span class="fl">0.5</span>)</span>
<span id="cb66-6"><a href="maps.html#cb66-6"></a>)</span></code></pre></div>
<p>For those interested in learning more about geocomputation in R with <strong>sf</strong> and other great R packages like <strong>sp</strong> and <strong>raster</strong>, <span class="citation">Robin Lovelace (<a href="#ref-geocomputation" role="doc-biblioref">2019</a>)</span> provides lots of nice and freely available learning resources <span class="citation">(Pebesma and Bivand <a href="#ref-sp" role="doc-biblioref">2005</a>; Hijmans <a href="#ref-raster" role="doc-biblioref">2019</a>)</span>.</p>
</div>
<div id="cartograms" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Cartograms</h3>
<p></p>
<p>Cartograms distort the size of geo-spatial polygons to encode a numeric variable other than the land size. There are numerous types of cartograms and they are typically categorized by their ability to preserve shape and maintain contiguous regions. Cartograms has been shown to be an effective approach to both encode and teach about geo-spatial data, though the effects certainly vary by cartogram type <span class="citation">(Nusrat S, Alam MJ, Kobourov S. <a href="#ref-cartogram-vis" role="doc-biblioref">2018</a>)</span>.
The R package <strong>cartogram</strong> provides an interface to several popular cartogram algorithms <span class="citation">(Jeworutzki <a href="#ref-cartogram" role="doc-biblioref">2018</a>)</span>. A number of other R packages provide cartogram algorithms, but the great thing about <strong>cartogram</strong> is that all the functions can take an <strong>sf</strong> (or <strong>sp</strong>) object as input and return an <strong>sf</strong> object. This makes it incredibly easy to go from raw spatial objects, to transformed objects, to visual. Figure <a href="maps.html#fig:cartogram">4.13</a> demonstrates a continuous area cartogram of US population in 2014 using a rubber sheet distortion algorithm from <span class="citation">James A. Dougenik, Nicholas R. Chrisman, Duane R. Niemeyer (<a href="#ref-Dougenik" role="doc-biblioref">1985</a>)</span>.</p>
<p></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="maps.html#cb67-1"></a><span class="kw">library</span>(cartogram)</span>
<span id="cb67-2"><a href="maps.html#cb67-2"></a><span class="kw">library</span>(albersusa)</span>
<span id="cb67-3"><a href="maps.html#cb67-3"></a></span>
<span id="cb67-4"><a href="maps.html#cb67-4"></a>us_cont &lt;-<span class="st"> </span><span class="kw">cartogram_cont</span>(<span class="kw">usa_sf</span>(<span class="st">&quot;laea&quot;</span>), <span class="st">&quot;pop_2014&quot;</span>)</span>
<span id="cb67-5"><a href="maps.html#cb67-5"></a></span>
<span id="cb67-6"><a href="maps.html#cb67-6"></a><span class="kw">plot_ly</span>(us_cont) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-7"><a href="maps.html#cb67-7"></a><span class="st">  </span><span class="kw">add_sf</span>(</span>
<span id="cb67-8"><a href="maps.html#cb67-8"></a>    <span class="dt">color =</span> <span class="op">~</span>pop_<span class="dv">2014</span>, </span>
<span id="cb67-9"><a href="maps.html#cb67-9"></a>    <span class="dt">split =</span> <span class="op">~</span>name, </span>
<span id="cb67-10"><a href="maps.html#cb67-10"></a>    <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>),</span>
<span id="cb67-11"><a href="maps.html#cb67-11"></a>    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, scales<span class="op">::</span><span class="kw">number_si</span>(pop_<span class="dv">2014</span>)),</span>
<span id="cb67-12"><a href="maps.html#cb67-12"></a>    <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb67-13"><a href="maps.html#cb67-13"></a>    <span class="dt">hoveron =</span> <span class="st">&quot;fills&quot;</span></span>
<span id="cb67-14"><a href="maps.html#cb67-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb67-15"><a href="maps.html#cb67-15"></a><span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb67-16"><a href="maps.html#cb67-16"></a><span class="st">  </span><span class="kw">colorbar</span>(<span class="dt">title =</span> <span class="st">&quot;Population </span><span class="ch">\n</span><span class="st"> 2014&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:cartogram"></span>
<img src="images/cartogram.png" alt="A cartogram of US population in 2014. A cartogram sizes the area of geo-spatial objects proportional to some metric (e.g., population)." width="100%" data-url="/interactives/cartogram.html" />
<p class="caption">
FIGURE 4.13: A cartogram of US population in 2014. A cartogram sizes the area of geo-spatial objects proportional to some metric (e.g., population).
</p>
</div>
<p>Figure <a href="maps.html#fig:cartogram-dorling">4.14</a> demonstrates a non-continuous Dorling cartogram of US population in 2014 from <span class="citation">Dorling, D (<a href="#ref-Dorling" role="doc-biblioref">1996</a>)</span>. This cartogram does not try to preserve the shape of polygons (i.e., states), but instead uses circles instead to represent each geo-spatial object, then encodes the variable of interest (i.e., population) using the area of the circle.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="maps.html#cb68-1"></a>us &lt;-<span class="st"> </span><span class="kw">usa_sf</span>(<span class="st">&quot;laea&quot;</span>)</span>
<span id="cb68-2"><a href="maps.html#cb68-2"></a>us_dor &lt;-<span class="st"> </span><span class="kw">cartogram_dorling</span>(us, <span class="st">&quot;pop_2014&quot;</span>)</span>
<span id="cb68-3"><a href="maps.html#cb68-3"></a></span>
<span id="cb68-4"><a href="maps.html#cb68-4"></a><span class="kw">plot_ly</span>(<span class="dt">stroke =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>), <span class="dt">span =</span> <span class="kw">I</span>(<span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-5"><a href="maps.html#cb68-5"></a><span class="st">  </span><span class="kw">add_sf</span>(</span>
<span id="cb68-6"><a href="maps.html#cb68-6"></a>    <span class="dt">data =</span> us, </span>
<span id="cb68-7"><a href="maps.html#cb68-7"></a>    <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray95&quot;</span>),</span>
<span id="cb68-8"><a href="maps.html#cb68-8"></a>    <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb68-9"><a href="maps.html#cb68-9"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb68-10"><a href="maps.html#cb68-10"></a><span class="st">  </span><span class="kw">add_sf</span>(</span>
<span id="cb68-11"><a href="maps.html#cb68-11"></a>    <span class="dt">data =</span> us_dor, </span>
<span id="cb68-12"><a href="maps.html#cb68-12"></a>    <span class="dt">color =</span> <span class="op">~</span>pop_<span class="dv">2014</span>,</span>
<span id="cb68-13"><a href="maps.html#cb68-13"></a>    <span class="dt">split =</span> <span class="op">~</span>name, </span>
<span id="cb68-14"><a href="maps.html#cb68-14"></a>    <span class="dt">text =</span> <span class="op">~</span><span class="kw">paste</span>(name, scales<span class="op">::</span><span class="kw">number_si</span>(pop_<span class="dv">2014</span>)), </span>
<span id="cb68-15"><a href="maps.html#cb68-15"></a>    <span class="dt">hoverinfo =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb68-16"><a href="maps.html#cb68-16"></a>    <span class="dt">hoveron =</span> <span class="st">&quot;fills&quot;</span></span>
<span id="cb68-17"><a href="maps.html#cb68-17"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb68-18"><a href="maps.html#cb68-18"></a><span class="st">  </span><span class="kw">layout</span>(<span class="dt">showlegend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:cartogram-dorling"></span>
<img src="images/cartogram-dorling.svg" alt="A dorling cartogram of US population in 2014. A dorling cartogram sizes the circles proportional to some metric (e.g., population)." width="100%" data-url="/interactives/cartogram-dorling.html" />
<p class="caption">
FIGURE 4.14: A dorling cartogram of US population in 2014. A dorling cartogram sizes the circles proportional to some metric (e.g., population).
</p>
</div>
<p>Figure <a href="maps.html#fig:cartogram-ncont">4.15</a> demonstrates a non-continuous cartogram of US population in 2014 from <span class="citation">Olson, J. M. (<a href="#ref-Olson" role="doc-biblioref">1976</a>)</span>. In contrast to the Dorling cartogram, this approach does preserve the shape of polygons. The implementation behind Figure <a href="maps.html#fig:cartogram-ncont">4.15</a> is to simply take the implementation of Figure <a href="maps.html#fig:cartogram-dorling">4.14</a> and change <code>cartogram_dorling()</code> to <code>cartogram_ncont()</code>.</p>
<div class="figure" style="text-align: center"><span id="fig:cartogram-ncont"></span>
<img src="images/cartogram-ncont.svg" alt="A non-contiguous cartogram of US population in 2014 that preserves shape." width="100%" data-url="/interactives/cartogram-ncont.html" />
<p class="caption">
FIGURE 4.15: A non-contiguous cartogram of US population in 2014 that preserves shape.
</p>
</div>
<p>A popular class of contiguous cartograms that do not preserve shape are sometimes referred to as tile cartograms (aka tilegrams). At the time of writing, there doesn’t seem to be a great R package for <em>computing</em> tilegrams, but Pitch Interactive provides a nice web service where you can generate tilegrams from existing or custom data <a href="https://pitchinteractiveinc.github.io/tilegrams/" class="uri">https://pitchinteractiveinc.github.io/tilegrams/</a>. Moreover, the service allows you to download a TopoJSON file of the generated tilegram, which we can read in R and convert into an <strong>sf</strong> object via <strong>geojsonio</strong> <span class="citation">(Chamberlain and Teucher <a href="#ref-geojsonio" role="doc-biblioref">2018</a>)</span>. Figure <a href="maps.html#fig:cartogram-tiles">4.16</a> demonstrates a tilegram of U.S. Population in 2016 exported directly from Pitch’s free web service.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="maps.html#cb69-1"></a><span class="kw">library</span>(geojsonio)</span>
<span id="cb69-2"><a href="maps.html#cb69-2"></a>tiles &lt;-<span class="st"> </span><span class="kw">geojson_read</span>(<span class="st">&quot;~/Downloads/tiles.topo.json&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;sp&quot;</span>)</span>
<span id="cb69-3"><a href="maps.html#cb69-3"></a>tiles_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(tiles)</span>
<span id="cb69-4"><a href="maps.html#cb69-4"></a><span class="kw">plot_ly</span>(tiles_sf, <span class="dt">split =</span> <span class="op">~</span>name)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:cartogram-tiles"></span>
<img src="images/cartogram-tiles.svg" alt="A tile cartogram of U.S. population in 2016." width="100%" data-url="/interactives/cartogram-tiles.html" />
<p class="caption">
FIGURE 4.16: A tile cartogram of U.S. population in 2016.
</p>
</div>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-geojsonio">
<p>Chamberlain, Scott, and Andy Teucher. 2018. <em>Geojsonio: Convert Data from and to ’Geojson’ or ’Topojson’</em>. <a href="https://CRAN.R-project.org/package=geojsonio">https://CRAN.R-project.org/package=geojsonio</a>.</p>
</div>
<div id="ref-Dorling">
<p>Dorling, D. 1996. “Area Cartograms: Their Use and Creation.” <em>Concepts and Techniques in Modern Geography (CATMOG)</em>.</p>
</div>
<div id="ref-raster">
<p>Hijmans, Robert J. 2019. <em>Raster: Geographic Data Analysis and Modeling</em>. <a href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>.</p>
</div>
<div id="ref-Dougenik">
<p>James A. Dougenik, Nicholas R. Chrisman, Duane R. Niemeyer. 1985. “An Algorithm to Construct Continuous Area Cartograms.” <em>The Professional Geographer</em>.</p>
</div>
<div id="ref-cartogram">
<p>Jeworutzki, Sebastian. 2018. <em>Cartogram: Create Cartograms with R</em>. <a href="https://CRAN.R-project.org/package=cartogram">https://CRAN.R-project.org/package=cartogram</a>.</p>
</div>
<div id="ref-USAboundaries">
<p>Mullen, Lincoln A., and Jordan Bratt. 2018. “USAboundaries: Historical and Contemporary Boundaries of the United States of America.” <em>Journal of Open Source Software</em> 3 (23): 314. <a href="https://doi.org/10.21105/joss.00314">https://doi.org/10.21105/joss.00314</a>.</p>
</div>
<div id="ref-election-maps">
<p>Newman, Mark. 2016. “Maps of the 2016 Us Presidential Election Results.” Blog. <a href="http://www-personal.umich.edu/~mejn/election/2016/">http://www-personal.umich.edu/~mejn/election/2016/</a>.</p>
</div>
<div id="ref-cartogram-vis">
<p>Nusrat S, Alam MJ, Kobourov S. 2018. “Evaluating Cartogram Effectiveness.” <em>IEEE Trans Vis Comput Graph</em>. <a href="https://doi.org/10.1109/TVCG.2016.2642109">https://doi.org/10.1109/TVCG.2016.2642109</a>.</p>
</div>
<div id="ref-Olson">
<p>Olson, J. M. 1976. “Noncontiguous Area Cartograms.” <em>The Professional Geographer</em>.</p>
</div>
<div id="ref-sf">
<p>Pebesma, Edzer. 2018. <em>Sf: Simple Features for R</em>. <a href="https://CRAN.R-project.org/package=sf">https://CRAN.R-project.org/package=sf</a>.</p>
</div>
<div id="ref-sp">
<p>Pebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” <em>R News</em> 5 (2): 9–13. <a href="https://CRAN.R-project.org/doc/Rnews/">https://CRAN.R-project.org/doc/Rnews/</a>.</p>
</div>
<div id="ref-PROJ">
<p>PROJ contributors. 2018. <em>PROJ Coordinate Transformation Software Library</em>. Open Source Geospatial Foundation. <a href="https://proj4.org/">https://proj4.org/</a>.</p>
</div>
<div id="ref-RCore">
<p>R Core Team. 2016. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-geocomputation">
<p>Robin Lovelace, Jannes Muenchow, Jakub Nowosad. 2019. <em>Geocomputation with R</em>. Chapman and Hall/CRC.</p>
</div>
<div id="ref-ggplotly-blog-post">
<p>Sievert, Carson. 2018b. “Learning from and Improving Upon Ggplotly Conversions.” Blog. <a href="https://blog.cpsievert.me/2018/01/30/learning-improving-ggplotly-geom-sf/">https://blog.cpsievert.me/2018/01/30/learning-improving-ggplotly-geom-sf/</a>.</p>
</div>
<div id="ref-rnaturalearth">
<p>South, Andy. 2017. <em>Rnaturalearth: World Map Data from Natural Earth</em>. <a href="https://CRAN.R-project.org/package=rnaturalearth">https://CRAN.R-project.org/package=rnaturalearth</a>.</p>
</div>
<div id="ref-tidy-data">
<p>Wickham, Hadley. 2014b. “Tidy Data.” <em>The Journal of Statistical Software</em> 59 (10). <a href="http://www.jstatsoft.org/v59/i10/">http://www.jstatsoft.org/v59/i10/</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>Unfortunately, non-scatter traces currently don’t work with <code>plot_mapbox()</code>/ <code>plot_geo()</code> meaning that, for one, raster (i.e., heatmap) maps are not natively supported.<a href="maps.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>To see more examples of creating and using plotly.js’ integrated dropdown functionality to modify graphs, see <a href="https://plot.ly/r/dropdowns/" class="uri">https://plot.ly/r/dropdowns/</a><a href="maps.html#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>This is way more intuitive compared to older workflows based on, say using <code>ggplot2::fortify()</code> to obtain a data structure where a row to represents particular point along a feature and having another column track which point belongs to each feature (<a href="https://gis.stackexchange.com/questions/165974/r-fortify-causing-polygons-to-tear">for example</a>).<a href="maps.html#fnref14" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script>
  var header = document.querySelector(".book-header");

  var img = document.createElement("img");
  img.src = "images/rstudioCloud.svg";
  img.width = 200;
  img.align = "right";
  img.style = "margin-top:10px; float:right";

  var a = document.createElement("a");
  a.href = "https://rstudio.cloud/project/156701";
  a.target = "_blank";

  a.appendChild(img);
  header.appendChild(a);
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-60116966-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60116966-3');
</script>
<script>
window.onload = function() {

  var imgs = document.querySelectorAll('img');

  // Upon clicking an image, open a new window with the
  // dimensions of the image, pointing the `data-url` link
  var on_click = function (e) {
    var d = e.target.dataset || {};
    if (d.url) {
      // Add some extra height for the modebar
      var height = 'height=' + (e.target.clientHeight * 1.05);
      var width = 'width=' + e.target.clientWidth;
      var param = 'location=yes,' + height + ',' + width + ',scrollbars=yes,status=yes';
      window.open(e.target.dataset.url, '_blank', param);
    }
  };

  var on_hover = function (e) {
    var d = e.target.dataset || {};
    if (d.url) {
      e.target.style.cursor = 'pointer';
    }
  };

  for (var i = 0; i < imgs.length; i++) {
    imgs[i].addEventListener('click', on_click);
    imgs[i].addEventListener('mouseover', on_hover);
  }
};
</script>
            </section>

          </div>
        </div>
      </div>
<a href="scatter-traces.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bars-histograms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/creating-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
