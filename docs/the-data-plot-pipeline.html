<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>32 The data-plot-pipeline | Interactive web-based data visualization with R, plotly, and shiny</title>
  <meta name="description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  <meta name="generator" content="bookdown 0.16.5 and GitBook 2.6.7" />

  <meta property="og:title" content="32 The data-plot-pipeline | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  <meta name="github-repo" content="ropensci/plotly" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="32 The data-plot-pipeline | Interactive web-based data visualization with R, plotly, and shiny" />
  <meta name="twitter:site" content="@cpsievert" />
  <meta name="twitter:description" content="A useR guide to creating highly interactive graphics for exploratory and expository visualization." />
  

<meta name="author" content="Carson Sievert" />


<meta name="date" content="2019-12-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mathjax.html"/>
<link rel="next" href="improving-ggplotly.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<script src="libs/elevate-section-attrs/elevate-section-attrs.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/plotly-binding/plotly.js"></script>
<script src="libs/typedarray/typedarray.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main/plotly-latest.min.js"></script>
<link href="libs/selectize/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize/selectize.min.js"></script>
<link href="libs/colourpicker/colourpicker.min.css" rel="stylesheet" />
<script src="libs/colourpicker/colourpicker.min.js"></script>
<link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding/datatables.js"></script>
<link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/plotly.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/summary-fix.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="preface.html"><a href="preface.html#why-interactive-web-graphics-from-r"><i class="fa fa-check"></i><b>1.1</b> Why interactive web graphics <em>from R</em>?</a></li>
<li class="chapter" data-level="1.2" data-path="preface.html"><a href="preface.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.2</b> What you will learn</a></li>
<li class="chapter" data-level="1.3" data-path="preface.html"><a href="preface.html#what-you-wont-learn-much-of"><i class="fa fa-check"></i><b>1.3</b> What you won’t learn (much of)</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="preface.html"><a href="preface.html#web-technologies"><i class="fa fa-check"></i><b>1.3.1</b> Web technologies</a></li>
<li class="chapter" data-level="1.3.2" data-path="preface.html"><a href="preface.html#d3js"><i class="fa fa-check"></i><b>1.3.2</b> d3js</a></li>
<li class="chapter" data-level="1.3.3" data-path="preface.html"><a href="preface.html#ggplot2"><i class="fa fa-check"></i><b>1.3.3</b> ggplot2</a></li>
<li class="chapter" data-level="1.3.4" data-path="preface.html"><a href="preface.html#graphical-data-analysis"><i class="fa fa-check"></i><b>1.3.4</b> Graphical data analysis</a></li>
<li class="chapter" data-level="1.3.5" data-path="preface.html"><a href="preface.html#data-visualization-best-practices"><i class="fa fa-check"></i><b>1.3.5</b> Data visualization best practices</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="preface.html"><a href="preface.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a></li>
<li class="chapter" data-level="1.5" data-path="preface.html"><a href="preface.html#run-code-examples"><i class="fa fa-check"></i><b>1.5</b> Run code examples</a></li>
<li class="chapter" data-level="1.6" data-path="preface.html"><a href="preface.html#getting-help-and-learning-more"><i class="fa fa-check"></i><b>1.6</b> Getting help and learning more</a></li>
<li class="chapter" data-level="1.7" data-path="preface.html"><a href="preface.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.8" data-path="preface.html"><a href="preface.html#colophon"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Creating views</b></span></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#intro-plotly"><i class="fa fa-check"></i><b>2.1</b> Intro to <code>plot_ly()</code></a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#intro-plotly-js"><i class="fa fa-check"></i><b>2.2</b> Intro to plotly.js</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#intro-ggplotly"><i class="fa fa-check"></i><b>2.3</b> Intro to <code>ggplotly()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scatter-traces.html"><a href="scatter-traces.html"><i class="fa fa-check"></i><b>3</b> Scattered foundations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#markers"><i class="fa fa-check"></i><b>3.1</b> Markers</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-alpha"><i class="fa fa-check"></i><b>3.1.1</b> Alpha blending</a></li>
<li class="chapter" data-level="3.1.2" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-color"><i class="fa fa-check"></i><b>3.1.2</b> Colors</a></li>
<li class="chapter" data-level="3.1.3" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-symbol"><i class="fa fa-check"></i><b>3.1.3</b> Symbols</a></li>
<li class="chapter" data-level="3.1.4" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-stroke"><i class="fa fa-check"></i><b>3.1.4</b> Stroke and span</a></li>
<li class="chapter" data-level="3.1.5" data-path="scatter-traces.html"><a href="scatter-traces.html#marker-size"><i class="fa fa-check"></i><b>3.1.5</b> Size</a></li>
<li class="chapter" data-level="3.1.6" data-path="scatter-traces.html"><a href="scatter-traces.html#dot-plots"><i class="fa fa-check"></i><b>3.1.6</b> Dotplots &amp; error bars</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="scatter-traces.html"><a href="scatter-traces.html#lines"><i class="fa fa-check"></i><b>3.2</b> Lines</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="scatter-traces.html"><a href="scatter-traces.html#linetypes"><i class="fa fa-check"></i><b>3.2.1</b> Linetypes</a></li>
<li class="chapter" data-level="3.2.2" data-path="scatter-traces.html"><a href="scatter-traces.html#segments"><i class="fa fa-check"></i><b>3.2.2</b> Segments</a></li>
<li class="chapter" data-level="3.2.3" data-path="scatter-traces.html"><a href="scatter-traces.html#density-plots"><i class="fa fa-check"></i><b>3.2.3</b> Density plots</a></li>
<li class="chapter" data-level="3.2.4" data-path="scatter-traces.html"><a href="scatter-traces.html#parallel-coordinates"><i class="fa fa-check"></i><b>3.2.4</b> Parallel Coordinates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scatter-traces.html"><a href="scatter-traces.html#polygons"><i class="fa fa-check"></i><b>3.3</b> Polygons</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="scatter-traces.html"><a href="scatter-traces.html#ribbons"><i class="fa fa-check"></i><b>3.3.1</b> Ribbons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>4</b> Maps</a>
<ul>
<li class="chapter" data-level="4.1" data-path="maps.html"><a href="maps.html#maps-integrated"><i class="fa fa-check"></i><b>4.1</b> Integrated maps</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="maps.html"><a href="maps.html#overview-1"><i class="fa fa-check"></i><b>4.1.1</b> Overview</a></li>
<li class="chapter" data-level="4.1.2" data-path="maps.html"><a href="maps.html#choropleths"><i class="fa fa-check"></i><b>4.1.2</b> Choropleths</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="maps.html"><a href="maps.html#maps-custom"><i class="fa fa-check"></i><b>4.2</b> Custom maps</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="maps.html"><a href="maps.html#sf"><i class="fa fa-check"></i><b>4.2.1</b> Simple features (sf)</a></li>
<li class="chapter" data-level="4.2.2" data-path="maps.html"><a href="maps.html#cartograms"><i class="fa fa-check"></i><b>4.2.2</b> Cartograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bars-histograms.html"><a href="bars-histograms.html"><i class="fa fa-check"></i><b>5</b> Bars &amp; histograms</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-numeric-distributions"><i class="fa fa-check"></i><b>5.1</b> Multiple numeric distributions</a></li>
<li class="chapter" data-level="5.2" data-path="bars-histograms.html"><a href="bars-histograms.html#multiple-discrete-distributions"><i class="fa fa-check"></i><b>5.2</b> Multiple discrete distributions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="boxplots.html"><a href="boxplots.html"><i class="fa fa-check"></i><b>6</b> Boxplots</a></li>
<li class="chapter" data-level="7" data-path="frequencies-2D.html"><a href="frequencies-2D.html"><i class="fa fa-check"></i><b>7</b> 2D frequencies</a>
<ul>
<li class="chapter" data-level="7.1" data-path="frequencies-2D.html"><a href="frequencies-2D.html#rectangular-binning-in-plotly.js"><i class="fa fa-check"></i><b>7.1</b> Rectangular binning in plotly.js</a></li>
<li class="chapter" data-level="7.2" data-path="frequencies-2D.html"><a href="frequencies-2D.html#rectangular-binning-in-r"><i class="fa fa-check"></i><b>7.2</b> Rectangular binning in R</a></li>
<li class="chapter" data-level="7.3" data-path="frequencies-2D.html"><a href="frequencies-2D.html#categorical-axes"><i class="fa fa-check"></i><b>7.3</b> Categorical axes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="d-charts.html"><a href="d-charts.html"><i class="fa fa-check"></i><b>8</b> 3D charts</a>
<ul>
<li class="chapter" data-level="8.1" data-path="d-charts.html"><a href="d-charts.html#markers-1"><i class="fa fa-check"></i><b>8.1</b> Markers</a></li>
<li class="chapter" data-level="8.2" data-path="d-charts.html"><a href="d-charts.html#paths"><i class="fa fa-check"></i><b>8.2</b> Paths</a></li>
<li class="chapter" data-level="8.3" data-path="d-charts.html"><a href="d-charts.html#lines-1"><i class="fa fa-check"></i><b>8.3</b> Lines</a></li>
<li class="chapter" data-level="8.4" data-path="d-charts.html"><a href="d-charts.html#axes"><i class="fa fa-check"></i><b>8.4</b> Axes</a></li>
<li class="chapter" data-level="8.5" data-path="d-charts.html"><a href="d-charts.html#surfaces"><i class="fa fa-check"></i><b>8.5</b> Surfaces</a></li>
</ul></li>
<li class="part"><span><b>II Publishing views</b></span></li>
<li class="chapter" data-level="9" data-path="publish.html"><a href="publish.html"><i class="fa fa-check"></i><b>9</b> Introduction</a></li>
<li class="chapter" data-level="10" data-path="saving.html"><a href="saving.html"><i class="fa fa-check"></i><b>10</b> Saving and embedding HTML</a></li>
<li class="chapter" data-level="11" data-path="exporting-static-images.html"><a href="exporting-static-images.html"><i class="fa fa-check"></i><b>11</b> Exporting static images</a>
<ul>
<li class="chapter" data-level="11.1" data-path="exporting-static-images.html"><a href="exporting-static-images.html#with-code"><i class="fa fa-check"></i><b>11.1</b> With code</a></li>
<li class="chapter" data-level="11.2" data-path="exporting-static-images.html"><a href="exporting-static-images.html#from-a-browser"><i class="fa fa-check"></i><b>11.2</b> From a browser</a></li>
<li class="chapter" data-level="11.3" data-path="exporting-static-images.html"><a href="exporting-static-images.html#sizing-exports"><i class="fa fa-check"></i><b>11.3</b> Sizing exports</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="editing-views.html"><a href="editing-views.html"><i class="fa fa-check"></i><b>12</b> Editing views for publishing</a></li>
<li class="part"><span><b>III Combining multiple views</b></span></li>
<li class="chapter" data-level="13" data-path="arranging-views.html"><a href="arranging-views.html"><i class="fa fa-check"></i><b>13</b> Arranging views</a>
<ul>
<li class="chapter" data-level="13.1" data-path="arranging-views.html"><a href="arranging-views.html#arranging-plotly-objects"><i class="fa fa-check"></i><b>13.1</b> Arranging plotly objects</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="arranging-views.html"><a href="arranging-views.html#recursive-subplots"><i class="fa fa-check"></i><b>13.1.1</b> Recursive subplots</a></li>
<li class="chapter" data-level="13.1.2" data-path="arranging-views.html"><a href="arranging-views.html#other-approaches-applications"><i class="fa fa-check"></i><b>13.1.2</b> Other approaches &amp; applications</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="arranging-views.html"><a href="arranging-views.html#arranging-htmlwidgets"><i class="fa fa-check"></i><b>13.2</b> Arranging htmlwidgets</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="arranging-views.html"><a href="arranging-views.html#flexdashboard"><i class="fa fa-check"></i><b>13.2.1</b> Flexdashboard</a></li>
<li class="chapter" data-level="13.2.2" data-path="arranging-views.html"><a href="arranging-views.html#bootstrap-grid-layout"><i class="fa fa-check"></i><b>13.2.2</b> Bootstrap grid layout</a></li>
<li class="chapter" data-level="13.2.3" data-path="arranging-views.html"><a href="arranging-views.html#css-flexbox"><i class="fa fa-check"></i><b>13.2.3</b> CSS flexbox</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="arranging-views.html"><a href="arranging-views.html#navigating-many-views"><i class="fa fa-check"></i><b>13.3</b> Arranging many views</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="animating-views.html"><a href="animating-views.html"><i class="fa fa-check"></i><b>14</b> Animating views</a>
<ul>
<li class="chapter" data-level="14.1" data-path="animating-views.html"><a href="animating-views.html#animation-api"><i class="fa fa-check"></i><b>14.1</b> Animation API</a></li>
<li class="chapter" data-level="14.2" data-path="animating-views.html"><a href="animating-views.html#animation-support"><i class="fa fa-check"></i><b>14.2</b> Animation support</a></li>
</ul></li>
<li class="part"><span><b>IV Linking multiple views</b></span></li>
<li class="chapter" data-level="15" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>15</b> Introduction</a></li>
<li class="chapter" data-level="16" data-path="client-side-linking.html"><a href="client-side-linking.html"><i class="fa fa-check"></i><b>16</b> Client-side linking</a>
<ul>
<li class="chapter" data-level="16.1" data-path="client-side-linking.html"><a href="client-side-linking.html#graphical-queries"><i class="fa fa-check"></i><b>16.1</b> Graphical queries</a></li>
<li class="chapter" data-level="16.2" data-path="client-side-linking.html"><a href="client-side-linking.html#filter"><i class="fa fa-check"></i><b>16.2</b> Highlight versus filter events</a></li>
<li class="chapter" data-level="16.3" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-animated-views"><i class="fa fa-check"></i><b>16.3</b> Linking animated views</a></li>
<li class="chapter" data-level="16.4" data-path="client-side-linking.html"><a href="client-side-linking.html#querying-examples"><i class="fa fa-check"></i><b>16.4</b> Examples</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="client-side-linking.html"><a href="client-side-linking.html#trellis-linking"><i class="fa fa-check"></i><b>16.4.1</b> Querying facetted charts</a></li>
<li class="chapter" data-level="16.4.2" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries"><i class="fa fa-check"></i><b>16.4.2</b> Statistical queries</a></li>
<li class="chapter" data-level="16.4.3" data-path="client-side-linking.html"><a href="client-side-linking.html#statistical-queries-ggplot"><i class="fa fa-check"></i><b>16.4.3</b> Statistical queries with <code>ggplotly()</code></a></li>
<li class="chapter" data-level="16.4.4" data-path="client-side-linking.html"><a href="client-side-linking.html#geo-spatial-queries"><i class="fa fa-check"></i><b>16.4.4</b> Geo-spatial queries</a></li>
<li class="chapter" data-level="16.4.5" data-path="client-side-linking.html"><a href="client-side-linking.html#linking-with-other-htmlwidgets"><i class="fa fa-check"></i><b>16.4.5</b> Linking with other htmlwidgets</a></li>
<li class="chapter" data-level="16.4.6" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggpairs"><i class="fa fa-check"></i><b>16.4.6</b> Generalized pairs plots</a></li>
<li class="chapter" data-level="16.4.7" data-path="client-side-linking.html"><a href="client-side-linking.html#ggally-ggnostic"><i class="fa fa-check"></i><b>16.4.7</b> Querying diagnostic plots</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="client-side-linking.html"><a href="client-side-linking.html#limitations"><i class="fa fa-check"></i><b>16.5</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html"><i class="fa fa-check"></i><b>17</b> Server-side linking with shiny</a>
<ul>
<li class="chapter" data-level="17.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#hello-shiny"><i class="fa fa-check"></i><b>17.1</b> Embedding plotly in shiny</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>17.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="17.1.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#hiding-and-redrawing-on-resize"><i class="fa fa-check"></i><b>17.1.2</b> Hiding and redrawing on resize</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#shiny-plotly-inputs"><i class="fa fa-check"></i><b>17.2</b> Leveraging plotly input events</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#dragging-events"><i class="fa fa-check"></i><b>17.2.1</b> Dragging events</a></li>
<li class="chapter" data-level="17.2.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#d-events"><i class="fa fa-check"></i><b>17.2.2</b> 3D events</a></li>
<li class="chapter" data-level="17.2.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#edit-events"><i class="fa fa-check"></i><b>17.2.3</b> Edit events</a></li>
<li class="chapter" data-level="17.2.4" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#relayout-vs-restyle-events"><i class="fa fa-check"></i><b>17.2.4</b> Relayout vs restyle events</a></li>
<li class="chapter" data-level="17.2.5" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#scoping-events"><i class="fa fa-check"></i><b>17.2.5</b> Scoping events</a></li>
<li class="chapter" data-level="17.2.6" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#event-priority"><i class="fa fa-check"></i><b>17.2.6</b> Event priority</a></li>
<li class="chapter" data-level="17.2.7" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#handling-discrete-axes"><i class="fa fa-check"></i><b>17.2.7</b> Handling discrete axes</a></li>
<li class="chapter" data-level="17.2.8" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#reactive-vals"><i class="fa fa-check"></i><b>17.2.8</b> Accumulating and managing event data</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#shiny-performance"><i class="fa fa-check"></i><b>17.3</b> Improving performance</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#proxies"><i class="fa fa-check"></i><b>17.3.1</b> Partial plotly updates</a></li>
<li class="chapter" data-level="17.3.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#partial-update-examples"><i class="fa fa-check"></i><b>17.3.2</b> Partial update examples</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#advanced-applications"><i class="fa fa-check"></i><b>17.4</b> Advanced applications</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#drill-down"><i class="fa fa-check"></i><b>17.4.1</b> Drill-down</a></li>
<li class="chapter" data-level="17.4.2" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#crossfilter"><i class="fa fa-check"></i><b>17.4.2</b> Cross-filter</a></li>
<li class="chapter" data-level="17.4.3" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#drag-brush"><i class="fa fa-check"></i><b>17.4.3</b> A draggable brush</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="linking-views-with-shiny.html"><a href="linking-views-with-shiny.html#discussion"><i class="fa fa-check"></i><b>17.5</b> Discussion</a></li>
</ul></li>
<li class="part"><span><b>V Event handling in JavaScript</b></span></li>
<li class="chapter" data-level="18" data-path="javascript.html"><a href="javascript.html"><i class="fa fa-check"></i><b>18</b> Introduction</a></li>
<li class="chapter" data-level="19" data-path="json.html"><a href="json.html"><i class="fa fa-check"></i><b>19</b> Working with JSON</a>
<ul>
<li class="chapter" data-level="19.1" data-path="json.html"><a href="json.html#assignment-subsetting-and-iteration"><i class="fa fa-check"></i><b>19.1</b> Assignment, subsetting, and iteration</a></li>
<li class="chapter" data-level="19.2" data-path="json.html"><a href="json.html#mapping-r-to-json"><i class="fa fa-check"></i><b>19.2</b> Mapping R to JSON</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="js-event-handlers.html"><a href="js-event-handlers.html"><i class="fa fa-check"></i><b>20</b> Adding custom event handlers</a></li>
<li class="chapter" data-level="21" data-path="supplying-custom-data.html"><a href="supplying-custom-data.html"><i class="fa fa-check"></i><b>21</b> Supplying custom data</a></li>
<li class="chapter" data-level="22" data-path="client-side.html"><a href="client-side.html"><i class="fa fa-check"></i><b>22</b> Leveraging web technologies from R</a>
<ul>
<li class="chapter" data-level="22.1" data-path="client-side.html"><a href="client-side.html#web-infrastructure"><i class="fa fa-check"></i><b>22.1</b> Web infrastructure</a></li>
<li class="chapter" data-level="22.2" data-path="client-side.html"><a href="client-side.html#react"><i class="fa fa-check"></i><b>22.2</b> Modern JS &amp; React</a></li>
</ul></li>
<li class="part"><span><b>VI Various special topics</b></span></li>
<li class="chapter" data-level="23" data-path="is-plotly-free-secure.html"><a href="is-plotly-free-secure.html"><i class="fa fa-check"></i><b>23</b> Is plotly free &amp; secure?</a></li>
<li class="chapter" data-level="24" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a></li>
<li class="chapter" data-level="25" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html"><i class="fa fa-check"></i><b>25</b> Controlling tooltips</a>
<ul>
<li class="chapter" data-level="25.1" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text"><i class="fa fa-check"></i><b>25.1</b> <code>plot_ly()</code> tooltips</a></li>
<li class="chapter" data-level="25.2" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#tooltip-text-ggplotly"><i class="fa fa-check"></i><b>25.2</b> <code>ggplotly()</code> tooltips</a></li>
<li class="chapter" data-level="25.3" data-path="controlling-tooltips.html"><a href="controlling-tooltips.html#styling"><i class="fa fa-check"></i><b>25.3</b> Styling</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="control-modebar.html"><a href="control-modebar.html"><i class="fa fa-check"></i><b>26</b> Control the modebar</a>
<ul>
<li class="chapter" data-level="26.1" data-path="control-modebar.html"><a href="control-modebar.html#remove-the-entire-modebar"><i class="fa fa-check"></i><b>26.1</b> Remove the entire modebar</a></li>
<li class="chapter" data-level="26.2" data-path="control-modebar.html"><a href="control-modebar.html#remove-the-plotly-logo"><i class="fa fa-check"></i><b>26.2</b> Remove the plotly logo</a></li>
<li class="chapter" data-level="26.3" data-path="control-modebar.html"><a href="control-modebar.html#remove-modebar-buttons-by-name"><i class="fa fa-check"></i><b>26.3</b> Remove modebar buttons by name</a></li>
<li class="chapter" data-level="26.4" data-path="control-modebar.html"><a href="control-modebar.html#add-custom-modebar-buttons"><i class="fa fa-check"></i><b>26.4</b> Add custom modebar buttons</a></li>
<li class="chapter" data-level="26.5" data-path="control-modebar.html"><a href="control-modebar.html#control-image-downloads"><i class="fa fa-check"></i><b>26.5</b> Control image downloads</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="working-with-colors.html"><a href="working-with-colors.html"><i class="fa fa-check"></i><b>27</b> Working with colors</a></li>
<li class="chapter" data-level="28" data-path="working-with-symbols.html"><a href="working-with-symbols.html"><i class="fa fa-check"></i><b>28</b> Working with symbols and glyphs</a></li>
<li class="chapter" data-level="29" data-path="embedding-images.html"><a href="embedding-images.html"><i class="fa fa-check"></i><b>29</b> Embedding images</a></li>
<li class="chapter" data-level="30" data-path="locales.html"><a href="locales.html"><i class="fa fa-check"></i><b>30</b> Language support</a></li>
<li class="chapter" data-level="31" data-path="mathjax.html"><a href="mathjax.html"><i class="fa fa-check"></i><b>31</b> LaTeX rendering</a>
<ul>
<li class="chapter" data-level="31.1" data-path="mathjax.html"><a href="mathjax.html#mathjax-caveats"><i class="fa fa-check"></i><b>31.1</b> MathJax caveats</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="the-data-plot-pipeline.html"><a href="the-data-plot-pipeline.html"><i class="fa fa-check"></i><b>32</b> The data-plot-pipeline</a></li>
<li class="chapter" data-level="33" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html"><i class="fa fa-check"></i><b>33</b> Improving <code>ggplotly()</code></a>
<ul>
<li class="chapter" data-level="33.1" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#modifying-layout"><i class="fa fa-check"></i><b>33.1</b> Modifying layout</a></li>
<li class="chapter" data-level="33.2" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#modifying-data"><i class="fa fa-check"></i><b>33.2</b> Modifying data</a></li>
<li class="chapter" data-level="33.3" data-path="improving-ggplotly.html"><a href="improving-ggplotly.html#leveraging-statistical-output"><i class="fa fa-check"></i><b>33.3</b> Leveraging statistical output</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="custom-geoms.html"><a href="custom-geoms.html"><i class="fa fa-check"></i><b>34</b> Translating custom ggplot2 geoms</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Interactive web-based data visualization with R, plotly, and shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-data-plot-pipeline" class="section level1">
<h1><span class="header-section-number">32</span> The data-plot-pipeline</h1>
<p></p>
<p>As Chapter <a href="overview.html#intro-plotly">2.1</a> first introduced, we can express multi-layer <strong>plotly</strong> graphs as a sequence (or, more specifically, a directed acyclic graph) of <strong>dplyr</strong> data manipulations and mappings to visuals. For example, to create Figure <a href="the-data-plot-pipeline.html#fig:houston2">32.1</a>, we could group <code>txhousing</code> by <code>city</code> to ensure the first layer of <code>add_lines()</code> draws a different line for each city, then <code>filter()</code> down to Houston so that the second call to <code>add_lines()</code> draws only Houston.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="the-data-plot-pipeline.html#cb245-1"></a>allCities &lt;-<span class="st"> </span>txhousing <span class="op">%&gt;%</span></span>
<span id="cb245-2"><a href="the-data-plot-pipeline.html#cb245-2"></a><span class="st">  </span><span class="kw">group_by</span>(city) <span class="op">%&gt;%</span></span>
<span id="cb245-3"><a href="the-data-plot-pipeline.html#cb245-3"></a><span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>date, <span class="dt">y =</span> <span class="op">~</span>median) <span class="op">%&gt;%</span></span>
<span id="cb245-4"><a href="the-data-plot-pipeline.html#cb245-4"></a><span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">name =</span> <span class="st">&quot;Texan Cities&quot;</span>, <span class="dt">hoverinfo =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb245-5"><a href="the-data-plot-pipeline.html#cb245-5"></a>  </span>
<span id="cb245-6"><a href="the-data-plot-pipeline.html#cb245-6"></a>allCities <span class="op">%&gt;%</span></span>
<span id="cb245-7"><a href="the-data-plot-pipeline.html#cb245-7"></a><span class="st">  </span><span class="kw">filter</span>(city <span class="op">==</span><span class="st"> &quot;Houston&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb245-8"><a href="the-data-plot-pipeline.html#cb245-8"></a><span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">name =</span> <span class="st">&quot;Houston&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:houston2"></span>
<img src="images/houston2.svg" alt="Monthly median house prices over time for 46 Texan cities (in blue). Houston is highlighted in orange." width="100%" data-url="/interactives/houston2.html" />
<p class="caption">
FIGURE 32.1: Monthly median house prices over time for 46 Texan cities (in blue). Houston is highlighted in orange.
</p>
</div>
<p>Sometimes the directed acyclic graph property of a <strong>magrittr</strong> pipeline can be too restrictive for certain types of plots. In this example, after filtering the data down to Houston, there is no way to recover the original data inside the pipeline. The <code>add_fun()</code> function helps to work-around this restriction<a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a> – it works by applying a function to the plotly object, but does not affect the data associated with the plotly object. This effectively provides a way to isolate data transformations within the pipeline<a href="#fn45" class="footnote-ref" id="fnref45"><sup>45</sup></a>. Figure <a href="the-data-plot-pipeline.html#fig:houston-vs-sa">32.2</a> uses this idea to highlight both Houston and San Antonio.</p>
<p></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="the-data-plot-pipeline.html#cb246-1"></a>allCities <span class="op">%&gt;%</span></span>
<span id="cb246-2"><a href="the-data-plot-pipeline.html#cb246-2"></a><span class="st">  </span><span class="kw">add_fun</span>(<span class="cf">function</span>(plot) {</span>
<span id="cb246-3"><a href="the-data-plot-pipeline.html#cb246-3"></a>    plot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(city <span class="op">==</span><span class="st"> &quot;Houston&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb246-4"><a href="the-data-plot-pipeline.html#cb246-4"></a><span class="st">      </span><span class="kw">add_lines</span>(<span class="dt">name =</span> <span class="st">&quot;Houston&quot;</span>)</span>
<span id="cb246-5"><a href="the-data-plot-pipeline.html#cb246-5"></a>  }) <span class="op">%&gt;%</span></span>
<span id="cb246-6"><a href="the-data-plot-pipeline.html#cb246-6"></a><span class="st">  </span><span class="kw">add_fun</span>(<span class="cf">function</span>(plot) {</span>
<span id="cb246-7"><a href="the-data-plot-pipeline.html#cb246-7"></a>    plot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(city <span class="op">==</span><span class="st"> &quot;San Antonio&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb246-8"><a href="the-data-plot-pipeline.html#cb246-8"></a><span class="st">      </span><span class="kw">add_lines</span>(<span class="dt">name =</span> <span class="st">&quot;San Antonio&quot;</span>)</span>
<span id="cb246-9"><a href="the-data-plot-pipeline.html#cb246-9"></a>  })</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:houston-vs-sa"></span>
<img src="images/houston-vs-sa.svg" alt="Monthly median house price in Houston and San Antonio in comparison to other Texan cities." width="100%" data-url="/interactives/houston-vs-sa.html" />
<p class="caption">
FIGURE 32.2: Monthly median house price in Houston and San Antonio in comparison to other Texan cities.
</p>
</div>
<p>It is useful to think of the function supplied to <code>add_fun()</code> as a “layer” function – a function that accepts a plot object as input, possibly applies a transformation to the data, and maps that data to visual objects. To make layering functions more modular, flexible, and expressive, the <code>add_fun()</code> allows you to pass additional arguments to a layer function. Figure <a href="the-data-plot-pipeline.html#fig:summary">32.3</a> makes use of this pattern, by creating a reusable function for layering both a particular city as well as the first, second, and third quartile of median monthly house sales (by city).</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="the-data-plot-pipeline.html#cb247-1"></a><span class="co"># reusable function for highlighting a particular city</span></span>
<span id="cb247-2"><a href="the-data-plot-pipeline.html#cb247-2"></a>layer_city &lt;-<span class="st"> </span><span class="cf">function</span>(plot, name) {</span>
<span id="cb247-3"><a href="the-data-plot-pipeline.html#cb247-3"></a>  plot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(city <span class="op">==</span><span class="st"> </span>name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_lines</span>(<span class="dt">name =</span> name)</span>
<span id="cb247-4"><a href="the-data-plot-pipeline.html#cb247-4"></a>}</span>
<span id="cb247-5"><a href="the-data-plot-pipeline.html#cb247-5"></a></span>
<span id="cb247-6"><a href="the-data-plot-pipeline.html#cb247-6"></a><span class="co"># reusable function for plotting overall median &amp; IQR</span></span>
<span id="cb247-7"><a href="the-data-plot-pipeline.html#cb247-7"></a>layer_iqr &lt;-<span class="st"> </span><span class="cf">function</span>(plot) {</span>
<span id="cb247-8"><a href="the-data-plot-pipeline.html#cb247-8"></a>  plot <span class="op">%&gt;%</span></span>
<span id="cb247-9"><a href="the-data-plot-pipeline.html#cb247-9"></a><span class="st">    </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb247-10"><a href="the-data-plot-pipeline.html#cb247-10"></a><span class="st">    </span><span class="kw">summarise</span>(</span>
<span id="cb247-11"><a href="the-data-plot-pipeline.html#cb247-11"></a>      <span class="dt">q1 =</span> <span class="kw">quantile</span>(median, <span class="fl">0.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb247-12"><a href="the-data-plot-pipeline.html#cb247-12"></a>      <span class="dt">m =</span> <span class="kw">median</span>(median, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb247-13"><a href="the-data-plot-pipeline.html#cb247-13"></a>      <span class="dt">q3 =</span> <span class="kw">quantile</span>(median, <span class="fl">0.75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb247-14"><a href="the-data-plot-pipeline.html#cb247-14"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb247-15"><a href="the-data-plot-pipeline.html#cb247-15"></a><span class="st">    </span><span class="kw">add_lines</span>(<span class="dt">y =</span> <span class="op">~</span>m, <span class="dt">name =</span> <span class="st">&quot;median&quot;</span>, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb247-16"><a href="the-data-plot-pipeline.html#cb247-16"></a><span class="st">    </span><span class="kw">add_ribbons</span>(</span>
<span id="cb247-17"><a href="the-data-plot-pipeline.html#cb247-17"></a>      <span class="dt">ymin =</span> <span class="op">~</span>q1, <span class="dt">ymax =</span> <span class="op">~</span>q3, </span>
<span id="cb247-18"><a href="the-data-plot-pipeline.html#cb247-18"></a>      <span class="dt">name =</span> <span class="st">&quot;IQR&quot;</span>, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>)</span>
<span id="cb247-19"><a href="the-data-plot-pipeline.html#cb247-19"></a>    )</span>
<span id="cb247-20"><a href="the-data-plot-pipeline.html#cb247-20"></a>}</span>
<span id="cb247-21"><a href="the-data-plot-pipeline.html#cb247-21"></a></span>
<span id="cb247-22"><a href="the-data-plot-pipeline.html#cb247-22"></a>allCities <span class="op">%&gt;%</span></span>
<span id="cb247-23"><a href="the-data-plot-pipeline.html#cb247-23"></a><span class="st">  </span><span class="kw">add_fun</span>(layer_iqr) <span class="op">%&gt;%</span></span>
<span id="cb247-24"><a href="the-data-plot-pipeline.html#cb247-24"></a><span class="st">  </span><span class="kw">add_fun</span>(layer_city, <span class="st">&quot;Houston&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb247-25"><a href="the-data-plot-pipeline.html#cb247-25"></a><span class="st">  </span><span class="kw">add_fun</span>(layer_city, <span class="st">&quot;San Antonio&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:summary"></span>
<img src="images/summary.svg" alt="First, second, and third quartile of median monthly house price in Texas." width="100%" data-url="/interactives/summary.html" />
<p class="caption">
FIGURE 32.3: First, second, and third quartile of median monthly house price in Texas.
</p>
</div>
<p>A layering function does not have to be a data-plot-pipeline itself. Its only requirement on a layering function is that the first argument is a plot object and it returns a plot object. This provides an opportunity to say, fit a model to the plot data, extract the model components you desire, and map those components to visuals. Furthermore, since <strong>plotly</strong>’s <code>add_*()</code> functions don’t require a data.frame, you can supply those components directly to attributes (as long as they are well-defined), as done in Figure <a href="the-data-plot-pipeline.html#fig:forecast">32.4</a> via the <strong>forecast</strong> package <span class="citation">(Hyndman <a href="#ref-forecast" role="doc-biblioref">2018</a>)</span>.</p>
<p></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="the-data-plot-pipeline.html#cb248-1"></a><span class="kw">library</span>(forecast)</span>
<span id="cb248-2"><a href="the-data-plot-pipeline.html#cb248-2"></a>layer_forecast &lt;-<span class="st"> </span><span class="cf">function</span>(plot) {</span>
<span id="cb248-3"><a href="the-data-plot-pipeline.html#cb248-3"></a>  d &lt;-<span class="st"> </span><span class="kw">plotly_data</span>(plot)</span>
<span id="cb248-4"><a href="the-data-plot-pipeline.html#cb248-4"></a>  series &lt;-<span class="st"> </span><span class="kw">with</span>(d, </span>
<span id="cb248-5"><a href="the-data-plot-pipeline.html#cb248-5"></a>    <span class="kw">ts</span>(median, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">2000</span>, <span class="dv">1</span>), <span class="dt">end =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">7</span>))</span>
<span id="cb248-6"><a href="the-data-plot-pipeline.html#cb248-6"></a>  )</span>
<span id="cb248-7"><a href="the-data-plot-pipeline.html#cb248-7"></a>  fore &lt;-<span class="st"> </span><span class="kw">forecast</span>(<span class="kw">ets</span>(series), <span class="dt">h =</span> <span class="dv">48</span>, <span class="dt">level =</span> <span class="kw">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb248-8"><a href="the-data-plot-pipeline.html#cb248-8"></a>  plot <span class="op">%&gt;%</span></span>
<span id="cb248-9"><a href="the-data-plot-pipeline.html#cb248-9"></a><span class="st">    </span><span class="kw">add_ribbons</span>(<span class="dt">x =</span> <span class="kw">time</span>(fore<span class="op">$</span>mean), <span class="dt">ymin =</span> fore<span class="op">$</span>lower[, <span class="dv">2</span>],</span>
<span id="cb248-10"><a href="the-data-plot-pipeline.html#cb248-10"></a>                <span class="dt">ymax =</span> fore<span class="op">$</span>upper[, <span class="dv">2</span>], <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray95&quot;</span>), </span>
<span id="cb248-11"><a href="the-data-plot-pipeline.html#cb248-11"></a>                <span class="dt">name =</span> <span class="st">&quot;95% confidence&quot;</span>, <span class="dt">inherit =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb248-12"><a href="the-data-plot-pipeline.html#cb248-12"></a><span class="st">    </span><span class="kw">add_ribbons</span>(<span class="dt">x =</span> <span class="kw">time</span>(fore<span class="op">$</span>mean), <span class="dt">ymin =</span> fore<span class="op">$</span>lower[, <span class="dv">1</span>],</span>
<span id="cb248-13"><a href="the-data-plot-pipeline.html#cb248-13"></a>                <span class="dt">ymax =</span> fore<span class="op">$</span>upper[, <span class="dv">1</span>], <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;gray80&quot;</span>), </span>
<span id="cb248-14"><a href="the-data-plot-pipeline.html#cb248-14"></a>                <span class="dt">name =</span> <span class="st">&quot;80% confidence&quot;</span>, <span class="dt">inherit =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb248-15"><a href="the-data-plot-pipeline.html#cb248-15"></a><span class="st">    </span><span class="kw">add_lines</span>(<span class="dt">x =</span> <span class="kw">time</span>(fore<span class="op">$</span>mean), <span class="dt">y =</span> fore<span class="op">$</span>mean, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;blue&quot;</span>), </span>
<span id="cb248-16"><a href="the-data-plot-pipeline.html#cb248-16"></a>              <span class="dt">name =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb248-17"><a href="the-data-plot-pipeline.html#cb248-17"></a>}</span>
<span id="cb248-18"><a href="the-data-plot-pipeline.html#cb248-18"></a></span>
<span id="cb248-19"><a href="the-data-plot-pipeline.html#cb248-19"></a>txhousing <span class="op">%&gt;%</span></span>
<span id="cb248-20"><a href="the-data-plot-pipeline.html#cb248-20"></a><span class="st">  </span><span class="kw">group_by</span>(city) <span class="op">%&gt;%</span></span>
<span id="cb248-21"><a href="the-data-plot-pipeline.html#cb248-21"></a><span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>date, <span class="dt">y =</span> <span class="op">~</span>median) <span class="op">%&gt;%</span></span>
<span id="cb248-22"><a href="the-data-plot-pipeline.html#cb248-22"></a><span class="st">  </span><span class="kw">add_lines</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">name =</span> <span class="st">&quot;Texan Cities&quot;</span>, <span class="dt">hoverinfo=</span><span class="st">&quot;none&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb248-23"><a href="the-data-plot-pipeline.html#cb248-23"></a><span class="st">  </span><span class="kw">add_fun</span>(layer_iqr) <span class="op">%&gt;%</span></span>
<span id="cb248-24"><a href="the-data-plot-pipeline.html#cb248-24"></a><span class="st">  </span><span class="kw">add_fun</span>(layer_forecast)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:forecast"></span>
<img src="images/forecast.svg" alt="Layering on a 4-year forecast from a exponential smoothing state space model." width="100%" data-url="/interactives/forecast.html" />
<p class="caption">
FIGURE 32.4: Layering on a 4-year forecast from a exponential smoothing state space model.
</p>
</div>
<p>In summary, the “data-plot-pipeline” is desirable for a number of reasons: (1) makes your code easier to read and understand, (2) encourages you to think of both your data and plots using a single, uniform data structure, which (3) makes it easy to combine and reuse transformations.</p>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-forecast">
<p>Hyndman, Rob J. 2018. <em>Forecast: Forecasting Functions for Time Series and Linear Models</em>. <a href="http://github.com/robjhyndman/forecast">http://github.com/robjhyndman/forecast</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="44">
<li id="fn44"><p>Credit to Winston Chang and Hadley Wickham for this idea. The <code>add_fun()</code> is very much like <code>layer_f()</code> function in <strong>ggvis</strong>.<a href="the-data-plot-pipeline.html#fnref44" class="footnote-back">↩︎</a></p></li>
<li id="fn45"><p>Also, effectively putting a <a href="http://www.memecreator.org/meme/yo-dawg-i-heard-u-like-pipelines-so-we-put-a-pipeline-in-your-pipeline">pipeline inside a pipeline</a><a href="the-data-plot-pipeline.html#fnref45" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script>
  var header = document.querySelector(".book-header");

  var img = document.createElement("img");
  img.src = "images/rstudioCloud.svg";
  img.width = 200;
  img.align = "right";
  img.style = "margin-top:10px; float:right";

  var a = document.createElement("a");
  a.href = "https://rstudio.cloud/project/156701";
  a.target = "_blank";

  a.appendChild(img);
  header.appendChild(a);
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-60116966-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60116966-3');
</script>
<script>
window.onload = function() {

  var imgs = document.querySelectorAll('img');

  // Upon clicking an image, open a new window with the
  // dimensions of the image, pointing the `data-url` link
  var on_click = function (e) {
    var d = e.target.dataset || {};
    if (d.url) {
      // Add some extra height for the modebar
      var height = 'height=' + (e.target.clientHeight * 1.05);
      var width = 'width=' + e.target.clientWidth;
      var param = 'location=yes,' + height + ',' + width + ',scrollbars=yes,status=yes';
      window.open(e.target.dataset.url, '_blank', param);
    }
  };

  var on_hover = function (e) {
    var d = e.target.dataset || {};
    if (d.url) {
      e.target.style.cursor = 'pointer';
    }
  };

  for (var i = 0; i < imgs.length; i++) {
    imgs[i].addEventListener('click', on_click);
    imgs[i].addEventListener('mouseover', on_hover);
  }
};
</script>
            </section>

          </div>
        </div>
      </div>
<a href="mathjax.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="improving-ggplotly.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cpsievert/plotly_book/edit/master/topics.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
